<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo Interativa: Passkeys para Pagamentos com SPC</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Estilos fornecidos pelo usu√°rio */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5; /* Cor de fundo suave */
            color: #333; /* Cor de texto padr√£o */
            line-height: 1.6;
        }
        .container {
            max-width: 960px; /* Container mais estreito */
            margin: 0 auto;
            padding: 2rem;
        }
        .header {
            background-color: #ffffff;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        .header img {
            max-width: 200px;
            height: auto;
            margin-bottom: 1rem;
            border-radius: 8px;
        }
        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #007bff; /* Azul prim√°rio */
            margin-bottom: 0.5rem;
        }
        .header p {
            font-size: 1.1rem;
            color: #555;
        }
        .section-title {
            font-size: 2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        .footer {
            text-align: center;
            padding: 2rem;
            color: #777;
            font-size: 0.9rem;
            margin-top: 2rem;
        }
        @media (max-width: 768px) {
            .header h1 { font-size: 2rem; }
            .header p { font-size: 1rem; }
            .section-title { font-size: 1.75rem; }
        }
        .brand-card {
            background-color: #ffffff;
            border-radius: 1.5rem;
            padding: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            height: 100%;
        }
        .brand-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .icon-svg {
            width: 3rem;
            height: 3rem;
            margin-bottom: 1rem;
            color: #007bff;
        }
        .central-concept {
            background-color: #007bff;
            color: white;
            border-radius: 2rem;
            padding: 2rem 3rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            font-size: 1.75rem;
            font-weight: 800;
            text-align: center;
            margin-bottom: 3rem;
            position: relative;
            z-index: 10;
        }
        .text-justified { text-align: justify; }
        .data-type-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
            margin-top: 2rem;
        }
        .data-type-item {
            background-color: #e0f2ff;
            color: #0056b3;
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            font-weight: 600;
            white-space: nowrap;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
        }
        .data-type-item:hover { background-color: #cceeff; }
        .data-detail-card {
            background-color: #ffffff;
            border-radius: 1rem;
            padding: 0.5rem 1.5rem;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 1rem;
        }
        .data-detail-card summary {
            font-size: 1.25rem;
            font-weight: 600;
            color: #333;
            padding: 1rem 0;
            cursor: pointer;
            outline: none;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .data-detail-card summary::-webkit-details-marker { display: none; }
        .data-detail-card summary::after {
            content: '‚ñº';
            font-size: 1rem;
            transition: transform 0.2s;
        }
        .data-detail-card details[open] summary::after { transform: rotate(180deg); }
        .kpi-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
            margin-top: 2rem;
            margin-bottom: 2rem;
        }
        @media (min-width: 768px) {
            .kpi-grid { grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }
        }
        .kpi-block {
            background-color: #ffffff;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .kpi-value {
            font-size: 3rem;
            font-weight: 800;
            color: #007bff;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .kpi-description {
            font-size: 1.125rem;
            color: #333;
            line-height: 1.4;
        }
        .kpi-arrow { color: #007bff; }
        .ai-analysis-section {
            background-color: #ffffff;
            border-radius: 1.5rem;
            padding: 2rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            margin-top: 3rem;
            margin-bottom: 3rem;
        }
        .ai-analysis-section textarea {
            width: 100%;
            min-height: 150px;
            padding: 1rem;
            border: 1px solid #cbd5e1;
            border-radius: 0.75rem;
            font-size: 1rem;
            margin-bottom: 1rem;
            resize: vertical;
        }
        .ai-analysis-section button {
            background-color: #007bff;
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 0.75rem;
            font-weight: 600;
            transition: background-color 0.2s ease-in-out;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            justify-content: center;
            width: fit-content;
            margin: 0 auto;
        }
        .ai-analysis-section button:hover { background-color: #0056b3; }
        .ai-analysis-section .loading-indicator {
            text-align: center;
            margin-top: 1rem;
            font-style: italic;
            color: #64748b;
        }
        .ai-analysis-section .ai-output {
            background-color: #f8fafc;
            border: 1px dashed #94a3b8;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-top: 2rem;
            text-align: left;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .language-button {
            background-color: #e0f2ff;
            color: #0056b3;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, border-color 0.2s ease-in-out;
            border: 2px solid transparent;
        }
        .language-button:hover { background-color: #cceeff; }
        .language-button.active {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }

        /* Estilos existentes que foram mantidos e/ou ajustados */
        body { background-color: #FDFBF8; }
        .sidebar-active {
            background-color: #EAE6E1;
            color: #1F2937;
            font-weight: 600;
        }
        .phone-mockup {
            width: 320px;
            height: 640px;
            background: #1F2937;
            border-radius: 36px;
            padding: 10px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            display: flex;
            flex-direction: column;
            position: relative;
        }
        .phone-screen {
            flex: 1;
            background: white;
            border-radius: 26px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .phone-header {
            background: #E5E7EB;
            padding: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .code-keyword { color: #A78BFA; }
        .code-function { color: #60A5FA; }
        .code-string { color: #FBBF24; }
        .code-comment { color: #9CA3AF; }
        .code-variable { color: #34D399; }
        pre {
            background-color: #1F2937;
            color: #E5E7EB;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            font-size: 0.875rem;
            margin-top: 1rem;
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body class="antialiased">

    <div class="flex min-h-screen">
        <aside class="w-64 bg-[#F5F1EC] p-6 hidden lg:block sticky top-0 h-screen">
            <h1 class="text-xl font-bold text-gray-800 mb-8" id="sidebar-title">Passkeys & Pagamentos</h1>
            <nav id="sidebar-nav">
                <a href="#intro" class="nav-link flex items-center px-4 py-3 rounded-lg text-gray-700 hover:bg-[#EAE6E1]">
                    <span class="mr-3">üëã</span> <span data-i18n="nav.intro">Introdu√ß√£o</span>
                </a>
                <a href="#creation" class="nav-link flex items-center px-4 py-3 mt-2 rounded-lg text-gray-700 hover:bg-[#EAE6E1]">
                    <span class="mr-3">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-key-round"><path d="M2 18v2a2 2 0 0 0 2 2h4"/><path d="M15 22h2a2 2 0 0 0 2-2v-2"/><path d="M2 13v-2a2 2 0 0 1 2-2h10l3-3 3 3v2l-3 3h-2"/><path d="M7 11h2"/></svg>
                    </span> <span data-i18n="nav.creation">Cria√ß√£o de Passkey</span>
                </a>
                <a href="#payment" class="nav-link flex items-center px-4 py-3 mt-2 rounded-lg text-gray-700 hover:bg-[#EAE6E1]">
                    <span class="mr-3">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-credit-card"><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></svg>
                    </span> <span data-i18n="nav.payment">Pagamento com SPC</span>
                </a>
                <a href="#details" class="nav-link flex items-center px-4 py-3 mt-2 rounded-lg text-gray-700 hover:bg-[#EAE6E1]">
                    <span class="mr-3">‚öôÔ∏è</span> <span data-i18n="nav.details">Detalhes T√©cnicos</span>
                </a>
                <a href="#security" class="nav-link flex items-center px-4 py-3 mt-2 rounded-lg text-gray-700 hover:bg-[#EAE6E1]">
                    <span class="mr-3">üõ°Ô∏è</span> <span data-i18n="nav.security">Seguran√ßa</span>
                </a>
            </nav>
        </aside>

        <main class="flex-1 p-4 sm:p-6 md:p-10">
            <div class="flex justify-end space-x-2 mb-4">
                <button class="language-button active" data-lang="pt">PT</button>
                <button class="language-button" data-lang="en">EN</button>
                <button class="language-button" data-lang="es">ES</button>
            </div>
            <div class="max-w-4xl mx-auto">
                <div class="lg:hidden mb-6">
                    <select id="mobile-nav" class="w-full p-3 border border-gray-300 rounded-lg bg-white">
                        <option value="intro" data-i18n="nav.intro">Introdu√ß√£o</option>
                        <option value="creation" data-i18n="nav.creation">Cria√ß√£o de Passkey</option>
                        <option value="payment" data-i18n="nav.payment">Pagamento com SPC</option>
                        <option value="details" data-i18n="nav.details">Detalhes T√©cnicos</option>
                        <option value="security" data-i18n="nav.security">Seguran√ßa</option>
                    </select>
                </div>

                <section id="intro" class="content-section">
                    <h2 class="text-3xl font-bold text-gray-900 mb-4" data-i18n="intro.title">Demonstra√ß√£o Interativa de Passkeys para Pagamentos</h2>
                    <p class="text-lg text-gray-600 mb-6" data-i18n="intro.p1">Esta aplica√ß√£o traduz o relat√≥rio t√©cnico sobre passkeys e Secure Payment Confirmation (SPC) em uma experi√™ncia interativa. O objetivo √© desmistificar os fluxos de cria√ß√£o e uso de passkeys em contextos de pagamento, fornecendo uma vis√£o clara da intera√ß√£o entre frontend, backend e navegador. Navegue pelas se√ß√µes para explorar cada etapa do processo.</p>
                    <div class="grid md:grid-cols-2 gap-6 mt-8">
                        <div class="bg-white p-6 rounded-xl border border-gray-200">
                            <h3 class="font-semibold text-lg text-gray-800 mb-2" data-i18n="intro.card1.title">O que s√£o Passkeys?</h3>
                            <p class="text-gray-600" data-i18n="intro.card1.p">Uma alternativa segura e resistente a phishing √†s senhas. Baseadas no padr√£o WebAuthn, usam criptografia de chave p√∫blica e permitem autentica√ß√£o com biometria ou PIN do dispositivo, eliminando a necessidade de senhas tradicionais.</p>
                        </div>
                        <div class="bg-white p-6 rounded-xl border border-gray-200">
                            <h3 class="font-semibold text-lg text-gray-800 mb-2" data-i18n="intro.card2.title">O que √© SPC?</h3>
                            <p class="text-gray-600" data-i18n="intro.card2.p">Secure Payment Confirmation √© uma API web que estende o WebAuthn. Ela foi projetada para autenticar transa√ß√µes, fornecendo prova criptogr√°fica de que o usu√°rio consentiu com os detalhes espec√≠ficos de um pagamento (valor, benefici√°rio), e n√£o apenas que fez login.</p>
                        </div>
                    </div>
                </section>
                
                <section id="creation" class="content-section hidden">
                    <h2 class="text-3xl font-bold text-gray-900 mb-2" data-i18n="creation.title">Cria√ß√£o de Passkey</h2>
                    <p class="text-lg text-gray-600 mb-8" data-i18n="creation.p1">Esta se√ß√£o descreve a jornada do usu√°rio para criar uma passkey em seu dispositivo. O processo garante que a conta do usu√°rio seja associada de forma segura a uma nova credencial criptogr√°fica, substituindo a necessidade de senhas. Use a simula√ß√£o abaixo para explorar o fluxo passo a passo.</p>
                    <div class="flex flex-col lg:flex-row gap-8">
                        <div class="flex-1">
                            <div class="phone-mockup mx-auto lg:mx-0">
                                <div class="phone-header rounded-t-xl text-gray-600">
                                    <span class="text-xs">9:41</span>
                                    <div class="w-12 h-4 bg-gray-800 rounded-b-xl -mt-1 mx-2"></div>
                                    <span class="text-xs">üì∂ üîã</span>
                                </div>
                                <div id="creation-phone-screen" class="phone-screen p-4 flex flex-col justify-between relative">
                                     <div class="w-full bg-gray-200 rounded-full h-2 mb-4">
                                        <div id="creation-progress-bar" class="bg-[#A78BFA] h-2 rounded-full transition-all duration-500 ease-in-out" style="width: 0%"></div>
                                    </div>
                                    <div id="creation-screen-content" class="text-center flex-1 flex flex-col items-center justify-center animate-fade-in">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#A78BFA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-key-round mb-4"><path d="M2 18v2a2 2 0 0 0 2 2h4"/><path d="M15 22h2a2 2 0 0 0 2-2v-2"/><path d="M2 13v-2a2 2 0 0 1 2-2h10l3-3 3 3v2l-3 3h-2"/><path d="M7 11h2"/></svg>
                                        <h3 class="text-xl font-semibold text-gray-800 mb-2" data-i18n="creation.screen1.title">Cria√ß√£o de Passkey</h3>
                                        <p class="text-gray-600" data-i18n="creation.screen1.p">Bem-vindo! Clique no bot√£o abaixo para iniciar o processo de cria√ß√£o da sua passkey.</p>
                                    </div>
                                    <div id="creation-screen-actions" class="flex flex-col space-y-4">
                                        <button class="bg-[#A78BFA] text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-[#8B5CF6] transition-colors" onclick="nextCreationStep()" data-i18n="creation.screen1.btn">Criar Passkey</button>
                                    </div>
                                </div>
                                <div class="h-4 bg-black rounded-b-3xl"></div>
                            </div>
                        </div>
                        <div id="creation-explanation" class="flex-1 bg-white p-6 rounded-xl border border-gray-200">
                            <h3 class="font-semibold text-lg text-gray-800" data-i18n="creation.explanation1.title">In√≠cio do Processo</h3>
                            <p class="text-gray-600 mt-2" data-i18n="creation.explanation1.p">Clique em "Criar Passkey" no celular para come√ßar a simula√ß√£o do fluxo. Cada passo ir√° atualizar esta √°rea com uma explica√ß√£o detalhada e c√≥digo de exemplo.</p>
                        </div>
                    </div>
                </section>

                <section id="payment" class="content-section hidden">
                    <h2 class="text-3xl font-bold text-gray-900 mb-2" data-i18n="payment.title">Pagamento com SPC</h2>
                    <p class="text-lg text-gray-600 mb-8" data-i18n="payment.p1">Aqui, exploramos como o Secure Payment Confirmation (SPC) utiliza passkeys para autorizar transa√ß√µes. O foco √© na seguran√ßa e na experi√™ncia do usu√°rio, garantindo que o consentimento do pagamento seja expl√≠cito e √† prova de adultera√ß√£o. Use a simula√ß√£o abaixo para explorar o fluxo passo a passo.</p>
                    <div class="flex flex-col lg:flex-row gap-8">
                        <div class="flex-1">
                            <div class="phone-mockup mx-auto lg:mx-0">
                                <div class="phone-header rounded-t-xl text-gray-600">
                                    <span class="text-xs">9:41</span>
                                    <div class="w-12 h-4 bg-gray-800 rounded-b-xl -mt-1 mx-2"></div>
                                    <span class="text-xs">üì∂ üîã</span>
                                </div>
                                <div id="payment-phone-screen" class="phone-screen p-4 flex flex-col justify-between relative">
                                    <div class="w-full bg-gray-200 rounded-full h-2 mb-4">
                                        <div id="payment-progress-bar" class="bg-[#34D399] h-2 rounded-full transition-all duration-500 ease-in-out" style="width: 0%"></div>
                                    </div>
                                    <div id="payment-screen-content" class="text-center flex-1 flex flex-col items-center justify-center animate-fade-in">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#34D399" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-credit-card mb-4"><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></svg>
                                        <h3 class="text-xl font-semibold text-gray-800 mb-2" data-i18n="payment.screen1.title">Pagar com Passkey</h3>
                                        <p class="text-gray-600" data-i18n="payment.screen1.p">Clique em "Pagar com Passkey" no celular para iniciar a simula√ß√£o de uma transa√ß√£o com SPC.</p>
                                    </div>
                                    <div id="payment-screen-actions" class="flex flex-col space-y-4">
                                        <button class="bg-[#34D399] text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-[#10B981] transition-colors" onclick="nextPaymentStep()" data-i18n="payment.screen1.btn">Pagar com Passkey</button>
                                    </div>
                                </div>
                                <div class="h-4 bg-black rounded-b-3xl"></div>
                            </div>
                        </div>
                        <div id="payment-explanation" class="flex-1 bg-white p-6 rounded-xl border border-gray-200">
                            <h3 class="font-semibold text-lg text-gray-800" data-i18n="payment.explanation1.title">In√≠cio do Pagamento</h3>
                            <p class="text-gray-600 mt-2" data-i18n="payment.explanation1.p">Clique em "Pagar com Passkey" no celular para come√ßar a simula√ß√£o do fluxo de pagamento. Cada passo ir√° atualizar esta √°rea com uma explica√ß√£o detalhada e c√≥digo de exemplo.</p>
                        </div>
                    </div>
                </section>

                <section id="details" class="content-section hidden">
                    <h2 class="text-3xl font-bold text-gray-900 mb-2" data-i18n="details.title">Detalhes T√©cnicos</h2>
                    <p class="text-lg text-gray-600 mb-8" data-i18n="details.p1">As opera√ß√µes de WebAuthn e SPC dependem de estruturas de dados espec√≠ficas. As tabelas abaixo detalham os par√¢metros-chave. Passe o mouse sobre uma linha para uma breve descri√ß√£o.</p>
                    <h3 class="text-2xl font-semibold text-gray-800 mt-8 mb-4" data-i18n="details.table1.title">Par√¢metros Chave do WebAuthn</h3>
                    <div class="overflow-x-auto bg-white rounded-xl border border-gray-200">
                        <table class="w-full text-left">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="p-4 font-semibold" data-i18n="details.table1.col1">Par√¢metro</th>
                                    <th class="p-4 font-semibold" data-i18n="details.table1.col2">Aplicabilidade</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                <tr class="hover:bg-gray-50" data-i18n-title="details.table1.row1.tooltip">
                                    <td class="p-4 font-mono">rp.id</td>
                                    <td class="p-4" data-i18n="details.table1.row1.p">Cria√ß√£o, Autentica√ß√£o</td>
                                </tr>
                                <tr class="hover:bg-gray-50" data-i18n-title="details.table1.row2.tooltip">
                                    <td class="p-4 font-mono">user.id</td>
                                    <td class="p-4" data-i18n="details.table1.row2.p">Cria√ß√£o</td>
                                </tr>
                                <tr class="hover:bg-gray-50" data-i18n-title="details.table1.row3.tooltip">
                                    <td class="p-4 font-mono">challenge</td>
                                    <td class="p-4" data-i18n="details.table1.row3.p">Cria√ß√£o, Autentica√ß√£o</td>
                                </tr>
                                <tr class="hover:bg-gray-50" data-i18n-title="details.table1.row4.tooltip">
                                    <td class="p-4 font-mono">pubKeyCredParams</td>
                                    <td class="p-4" data-i18n="details.table1.row4.p">Cria√ß√£o</td>
                                </tr>
                                <tr class="hover:bg-gray-50" data-i18n-title="details.table1.row5.tooltip">
                                    <td class="p-4 font-mono">userVerification</td>
                                    <td class="p-4" data-i18n="details.table1.row5.p">Cria√ß√£o, Autentica√ß√£o</td>
                                </tr>
                                <tr class="hover:bg-gray-50" data-i18n-title="details.table1.row6.tooltip">
                                    <td class="p-4 font-mono">mediation</td>
                                    <td class="p-4" data-i18n="details.table1.row6.p">Autentica√ß√£o</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <h3 class="text-2xl font-semibold text-gray-800 mt-8 mb-4" data-i18n="details.table2.title">Campos de Dados da Solicita√ß√£o SPC</h3>
                    <div class="overflow-x-auto bg-white rounded-xl border border-gray-200">
                        <table class="w-full text-left">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="p-4 font-semibold" data-i18n="details.table2.col1">Campo</th>
                                    <th class="p-4 font-semibold" data-i18n="details.table2.col2">Obrigat√≥rio</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                <tr class="hover:bg-gray-50" data-i18n-title="details.table2.row1.tooltip">
                                    <td class="p-4 font-mono">challenge</td>
                                    <td class="p-4" data-i18n="details.table2.row1.p">Obrigat√≥rio</td>
                                </tr>
                                <tr class="hover:bg-gray-50" data-i18n-title="details.table2.row2.tooltip">
                                    <td class="p-4 font-mono">credentialIds</td>
                                    <td class="p-4" data-i18n="details.table2.row2.p">Obrigat√≥rio</td>
                                </tr>
                                <tr class="hover:bg-gray-50" data-i18n-title="details.table2.row3.tooltip">
                                    <td class="p-4 font-mono">instrument.displayName</td>
                                    <td class="p-4" data-i18n="details.table2.row3.p">Obrigat√≥rio</td>
                                </tr>
                                <tr class="hover:bg-gray-50" data-i18n-title="details.table2.row4.tooltip">
                                    <td class="p-4 font-mono">instrument.icon</td>
                                    <td class="p-4" data-i18n="details.table2.row4.p">Obrigat√≥rio</td>
                                </tr>
                                <tr class="hover:bg-gray-50" data-i18n-title="details.table2.row5.tooltip">
                                    <td class="p-4 font-mono">payeeName</td>
                                    <td class="p-4" data-i18n="details.table2.row5.p">Opcional</td>
                                </tr>
                                 <tr class="hover:bg-gray-50" data-i18n-title="details.table2.row6.tooltip">
                                    <td class="p-4 font-mono">payeeOrigin</td>
                                    <td class="p-4" data-i18n="details.table2.row6.p">Opcional</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <section id="security" class="content-section hidden">
                    <h2 class="text-3xl font-bold text-gray-900 mb-2" data-i18n="security.title">Considera√ß√µes de Seguran√ßa</h2>
                    <p class="text-lg text-gray-600 mb-8" data-i18n="security.p1">A implementa√ß√£o de passkeys e SPC requer aten√ß√£o a detalhes de seguran√ßa cr√≠ticos para proteger os usu√°rios e as transa√ß√µes. O princ√≠pio mais importante √© a mitiga√ß√£o de ataques de repeti√ß√£o.</p>
                    <div class="bg-white p-6 rounded-xl border border-gray-200">
                        <div class="flex items-start">
                            <div class="flex-shrink-0 h-12 w-12 rounded-full bg-red-100 flex items-center justify-center">
                                <span class="text-2xl">üõ°Ô∏è</span>
                            </div>
                            <div class="ml-4">
                                <h3 class="font-semibold text-lg text-gray-800" data-i18n="security.card.title">Mitigando Ataques de Repeti√ß√£o com `challenge`</h3>
                                <p class="text-gray-600 mt-1" data-i18n="security.card.p1">O `challenge` √© a principal defesa contra ataques de repeti√ß√£o, onde um invasor intercepta uma resposta de autentica√ß√£o e a reutiliza.</p>
                                <ul class="list-disc list-inside mt-4 space-y-2 text-gray-600">
                                    <li data-i18n="security.card.li1"><strong>√önico por Solicita√ß√£o:</strong> O backend DEVE gerar um novo `challenge` criptograficamente seguro para cada tentativa de registro ou autentica√ß√£o.</li>
                                    <li data-i18n="security.card.li2"><strong>Validade Curta:</strong> O `challenge` deve ser armazenado na sess√£o do usu√°rio e ter uma vida √∫til curta (alguns minutos).</li>
                                    <li data-i18n="security.card.li3"><strong>Uso √önico:</strong> Uma vez que um `challenge` √© usado (seja em uma tentativa bem-sucedida ou falha), ele DEVE ser invalidado imediatamente no backend para que n√£o possa ser usado novamente.</li>
                                </ul>
                                <p class="text-sm text-gray-500 mt-4" data-i18n="security.card.p2">Usar uma biblioteca FIDO no lado do servidor (como SimpleWebAuthn) ajuda a gerenciar esses requisitos de seguran√ßa de forma robusta e confi√°vel.</p>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <script>
        const translations = {
            pt: {
                nav: {
                    intro: 'Introdu√ß√£o',
                    creation: 'Cria√ß√£o de Passkey',
                    payment: 'Pagamento com SPC',
                    details: 'Detalhes T√©cnicos',
                    security: 'Seguran√ßa'
                },
                intro: {
                    title: 'Demonstra√ß√£o Interativa de Passkeys para Pagamentos',
                    p1: 'Esta aplica√ß√£o traduz o relat√≥rio t√©cnico sobre passkeys e Secure Payment Confirmation (SPC) em uma experi√™ncia interativa. O objetivo √© desmistificar os fluxos de cria√ß√£o e uso de passkeys em contextos de pagamento, fornecendo uma vis√£o clara da intera√ß√£o entre frontend, backend e navegador. Navegue pelas se√ß√µes para explorar cada etapa do processo.',
                    card1: {
                        title: 'O que s√£o Passkeys?',
                        p: 'Uma alternativa segura e resistente a phishing √†s senhas. Baseadas no padr√£o WebAuthn, usam criptografia de chave p√∫blica e permitem autentica√ß√£o com biometria ou PIN do dispositivo, eliminando a necessidade de senhas tradicionais.'
                    },
                    card2: {
                        title: 'O que √© SPC?',
                        p: 'Secure Payment Confirmation √© uma API web que estende o WebAuthn. Ela foi projetada para autenticar transa√ß√µes, fornecendo prova criptogr√°fica de que o usu√°rio consentiu com os detalhes espec√≠ficos de um pagamento (valor, benefici√°rio), e n√£o apenas que fez login.'
                    }
                },
                creation: {
                    title: 'Cria√ß√£o de Passkey',
                    p1: 'Esta se√ß√£o descreve a jornada do usu√°rio para criar uma passkey em seu dispositivo. O processo garante que a conta do usu√°rio seja associada de forma segura a uma nova credencial criptogr√°fica, substituindo a necessidade de senhas. Use a simula√ß√£o abaixo para explorar o fluxo passo a passo.',
                    screen1: {
                        title: 'Cria√ß√£o de Passkey',
                        p: 'Bem-vindo! Clique no bot√£o abaixo para iniciar o processo de cria√ß√£o da sua passkey.',
                        btn: 'Criar Passkey'
                    },
                    explanation1: {
                        title: 'In√≠cio do Processo',
                        p: 'Clique em "Criar Passkey" no celular para come√ßar a simula√ß√£o do fluxo. Cada passo ir√° atualizar esta √°rea com uma explica√ß√£o detalhada e c√≥digo de exemplo.'
                    },
                    step1: {
                        title: 'Passo 1: Frontend Inicia o Registro',
                        p: 'A jornada come√ßa com o usu√°rio interagindo com a interface. O frontend, em resposta a essa a√ß√£o, faz uma chamada de rede para o backend para obter os par√¢metros necess√°rios para a cria√ß√£o da passkey. Esta √© a primeira etapa para garantir a seguran√ßa da transa√ß√£o.'
                    },
                    step2: {
                        title: 'Passo 2: Backend Gera Op√ß√µes',
                        p: 'O backend tem a responsabilidade cr√≠tica de gerar as op√ß√µes para a cria√ß√£o da credencial. A pe√ßa mais importante √© o <code>challenge</code>, um buffer de bytes aleat√≥rios e criptograficamente seguro que previne ataques de repeti√ß√£o.'
                    },
                    step3: {
                        title: 'Passo 3: Chamada navigator.credentials.create()',
                        p: 'Com as op√ß√µes do backend, o frontend invoca a API do navegador <code>navigator.credentials.create()</code>. O navegador ent√£o exibe uma interface nativa que pede a confirma√ß√£o do usu√°rio (biometria, PIN ou senha), garantindo uma experi√™ncia segura e consistente.'
                    },
                    step4: {
                        title: 'Passo 4: Backend Verifica e Armazena',
                        p: 'A credencial √© enviada de volta ao servidor, que a valida criptograficamente, verifica o <code>challenge</code> e armazena a chave p√∫blica no banco de dados. Este √© o passo final que garante a seguran√ßa e integridade do processo de registro.'
                    }
                },
                payment: {
                    title: 'Pagamento com SPC',
                    p1: 'Aqui, exploramos como o Secure Payment Confirmation (SPC) utiliza passkeys para autorizar transa√ß√µes. O foco √© na seguran√ßa e na experi√™ncia do usu√°rio, garantindo que o consentimento do pagamento seja expl√≠cito e √† prova de adultera√ß√£o. Use a simula√ß√£o abaixo para explorar o fluxo passo a passo.',
                    screen1: {
                        title: 'Pagar com Passkey',
                        p: 'Clique em "Pagar com Passkey" no celular para iniciar a simula√ß√£o de uma transa√ß√£o com SPC.',
                        btn: 'Pagar com Passkey'
                    },
                    explanation1: {
                        title: 'In√≠cio do Pagamento',
                        p: 'Clique em "Pagar com Passkey" no celular para come√ßar a simula√ß√£o do fluxo de pagamento. Cada passo ir√° atualizar esta √°rea com uma explica√ß√£o detalhada e c√≥digo de exemplo.'
                    },
                    step1: {
                        title: 'Passo 1: A√ß√£o do Usu√°rio',
                        p: 'O fluxo de pagamento come√ßa com o usu√°rio iniciando a transa√ß√£o. O frontend prepara a requisi√ß√£o de pagamento e solicita ao backend as op√ß√µes para o SPC, incluindo o token de seguran√ßa (challenge) e os detalhes da transa√ß√£o.'
                    },
                    step2: {
                        title: 'Passo 2: Exibi√ß√£o do Carrinho',
                        p: 'O usu√°rio revisa o carrinho de compras. Esta tela simula a interface do seu site. Ao clicar em "Finalizar Compra", o navegador iniciar√° o processo de Secure Payment Confirmation (SPC) para autenticar o pagamento de forma segura.'
                    },
                    step3: {
                        title: 'Passo 3: Backend Prepara Dados SPC',
                        p: 'O backend constr√≥i o objeto <code>SecurePaymentConfirmationRequest</code>, que cont√©m os detalhes da transa√ß√£o (como valor e benefici√°rio) e o <code>challenge</code>. Estes dados s√£o enviados para o frontend. A imagem acima √© apenas um mock visual.'
                    },
                    step4: {
                        title: 'Passo 4: Chamada PaymentRequest.show() com SPC',
                        p: 'O frontend usa a <code>PaymentRequest API</code> com o m√©todo <code>"secure-payment-confirmation"</code>. A API exibe a interface nativa do navegador para o usu√°rio, que assina a transa√ß√£o com sua passkey. Isso cria um v√≠nculo din√¢mico, provando que o usu√°rio consentiu com a transa√ß√£o e n√£o apenas fez login.'
                    },
                    step5: {
                        title: 'Passo 5: Autentica√ß√£o Biom√©trica do Usu√°rio',
                        p: 'Nesta etapa, o navegador exibe a interface de autentica√ß√£o nativa, como Face ID, Touch ID ou a digital do Android. A passkey √© usada para criar uma assinatura digital da transa√ß√£o, que ser√° enviada de volta ao servidor.'
                    },
                    step6: {
                        title: 'Passo 6: Backend Verifica a Assinatura',
                        p: 'O backend recebe a resposta do pagamento, que cont√©m uma asser√ß√£o WebAuthn. A verifica√ß√£o √© similar a um login, mas o backend tamb√©m verifica se os dados da transa√ß√£o no <code>clientDataJSON</code> correspondem aos dados que ele mesmo gerou. Se tudo estiver correto, o pagamento √© processado e o fluxo √© conclu√≠do.'
                    }
                },
                details: {
                    title: 'Detalhes T√©cnicos',
                    p1: 'As opera√ß√µes de WebAuthn e SPC dependem de estruturas de dados espec√≠ficas. As tabelas abaixo detalham os par√¢metros-chave. Passe o mouse sobre uma linha para uma breve descri√ß√£o.',
                    table1: {
                        title: 'Par√¢metros Chave do WebAuthn',
                        col1: 'Par√¢metro', col2: 'Aplicabilidade',
                        row1: { tooltip: 'Identificador da Parte Confi√°vel (geralmente o dom√≠nio do seu site).', p: 'Cria√ß√£o, Autentica√ß√£o' },
                        row2: { tooltip: 'Identificador √∫nico do usu√°rio no seu sistema, fornecido como um ArrayBuffer.', p: 'Cria√ß√£o' },
                        row3: { tooltip: 'Valor aleat√≥rio e √∫nico gerado pelo servidor para prevenir ataques de repeti√ß√£o.', p: 'Cria√ß√£o, Autentica√ß√£o' },
                        row4: { tooltip: 'Especifica os algoritmos de chave p√∫blica aceitos (ex: ES256).', p: 'Cria√ß√£o' },
                        row5: { tooltip: 'Exige que o usu√°rio se verifique (biometria/PIN), n√£o apenas que esteja presente.', p: 'Cria√ß√£o, Autentica√ß√£o' },
                        row6: { tooltip: 'Controla a UI do navegador, \'conditional\' permite o preenchimento autom√°tico.', p: 'Autentica√ß√£o' }
                    },
                    table2: {
                        title: 'Campos de Dados da Solicita√ß√£o SPC',
                        col1: 'Campo', col2: 'Obrigat√≥rio',
                        row1: { tooltip: 'Valor aleat√≥rio criptogr√°fico fornecido pelo servidor.', p: 'Obrigat√≥rio' },
                        row2: { tooltip: 'Lista de IDs de credenciais WebAuthn registradas para o pagamento.', p: 'Obrigat√≥rio' },
                        row3: { tooltip: 'Nome do instrumento de pagamento (ex: \'Visa **** 1234\').', p: 'Obrigat√≥rio' },
                        row4: { tooltip: 'URL do √≠cone do instrumento de pagamento (ex: logo da bandeira).', p: 'Obrigat√≥rio' },
                        row5: { tooltip: 'Nome de exibi√ß√£o do benefici√°rio (o comerciante).', p: 'Opcional' },
                        row6: { tooltip: 'Origem (dom√≠nio) do benefici√°rio.', p: 'Opcional' }
                    }
                },
                security: {
                    title: 'Considera√ß√µes de Seguran√ßa',
                    p1: 'A implementa√ß√£o de passkeys e SPC requer aten√ß√£o a detalhes de seguran√ßa cr√≠ticos para proteger os usu√°rios e as transa√ß√µes. O princ√≠pio mais importante √© a mitiga√ß√£o de ataques de repeti√ß√£o.',
                    card: {
                        title: 'Mitigando Ataques de Repeti√ß√£o com `challenge`',
                        p1: 'O `challenge` √© a principal defesa contra ataques de repeti√ß√£o, onde um invasor intercepta uma resposta de autentica√ß√£o e a reutiliza.',
                        li1: '<strong>√önico por Solicita√ß√£o:</strong> O backend DEVE gerar um novo `challenge` criptograficamente seguro para cada tentativa de registro ou autentica√ß√£o.',
                        li2: '<strong>Validade Curta:</strong> O `challenge` deve ser armazenado na sess√£o do usu√°rio e ter uma vida √∫til curta (alguns minutos).',
                        li3: '<strong>Uso √önico:</strong> Uma vez que um `challenge` √© usado (seja em uma tentativa bem-sucedida ou falha), ele DEVE ser invalidado imediatamente no backend para que n√£o possa ser usado novamente.',
                        p2: 'Usar uma biblioteca FIDO no lado do servidor (como SimpleWebAuthn) ajuda a gerenciar esses requisitos de seguran√ßa de forma robusta e confi√°vel.'
                    }
                }
            },
            en: {
                nav: {
                    intro: 'Introduction',
                    creation: 'Passkey Creation',
                    payment: 'Payment with SPC',
                    details: 'Technical Details',
                    security: 'Security'
                },
                intro: {
                    title: 'Interactive Passkeys for Payments Demo',
                    p1: 'This application translates the technical report on passkeys and Secure Payment Confirmation (SPC) into an interactive experience. The goal is to demystify the flows of creating and using passkeys in payment contexts, providing a clear view of the interaction between the frontend, backend, and browser. Navigate through the sections to explore each step of the process.',
                    card1: {
                        title: 'What are Passkeys?',
                        p: 'A secure and phishing-resistant alternative to passwords. Based on the WebAuthn standard, they use public key cryptography and allow authentication with biometrics or a device PIN, eliminating the need for traditional passwords.'
                    },
                    card2: {
                        title: 'What is SPC?',
                        p: 'Secure Payment Confirmation is a web API that extends WebAuthn. It is designed to authenticate transactions, providing cryptographic proof that the user has consented to the specific details of a payment (amount, payee), and not just that they have logged in.'
                    }
                },
                creation: {
                    title: 'Passkey Creation',
                    p1: 'This section describes the user journey to create a passkey on their device. The process ensures that the user\'s account is securely associated with a new cryptographic credential, replacing the need for passwords. Use the simulation below to explore the step-by-step flow.',
                    screen1: {
                        title: 'Passkey Creation',
                        p: 'Welcome! Click the button below to start the process of creating your passkey.',
                        btn: 'Create Passkey'
                    },
                    explanation1: {
                        title: 'Start of the Process',
                        p: 'Click "Create Passkey" on the phone to start the flow simulation. Each step will update this area with a detailed explanation and example code.'
                    },
                    step1: {
                        title: 'Step 1: Frontend Initiates Registration',
                        p: 'The journey begins with the user interacting with the interface. The frontend, in response to this action, makes a network call to the backend to get the necessary parameters for passkey creation. This is the first step to ensure the security of the transaction.'
                    },
                    step2: {
                        title: 'Step 2: Backend Generates Options',
                        p: 'The backend has the critical responsibility of generating the options for credential creation. The most important piece is the <code>challenge</code>, a cryptographically secure random byte buffer that prevents replay attacks.'
                    },
                    step3: {
                        title: 'Step 3: Call navigator.credentials.create()',
                        p: 'With the options from the backend, the frontend invokes the browser\'s API <code>navigator.credentials.create()</code>. The browser then displays a native interface that asks for user confirmation (biometrics, PIN, or password), ensuring a secure and consistent experience.'
                    },
                    step4: {
                        title: 'Step 4: Backend Verifies and Stores',
                        p: 'The credential is sent back to the server, which cryptographically validates it, verifies the <code>challenge</code>, and stores the public key in the database. This is the final step that ensures the security and integrity of the registration process.'
                    }
                },
                payment: {
                    title: 'Payment with SPC',
                    p1: 'Here, we explore how Secure Payment Confirmation (SPC) uses passkeys to authorize transactions. The focus is on security and user experience, ensuring that payment consent is explicit and tamper-proof. Use the simulation below to explore the step-by-step flow.',
                    screen1: {
                        title: 'Pay with Passkey',
                        p: 'Click "Pay with Passkey" on the phone to start the simulation of an SPC transaction.',
                        btn: 'Pay with Passkey'
                    },
                    explanation1: {
                        title: 'Start of Payment',
                        p: 'Click "Pay with Passkey" on the phone to start the payment flow simulation. Each step will update this area with a detailed explanation and example code.'
                    },
                    step1: {
                        title: 'Step 1: User Action',
                        p: 'The payment flow begins with the user initiating the transaction. The frontend prepares the payment request and asks the backend for the SPC options, including the security token (challenge) and transaction details.'
                    },
                    step2: {
                        title: 'Step 2: Displaying the Cart',
                        p: 'The user reviews the shopping cart. This screen simulates your site\'s interface. By clicking "Complete Purchase", the browser will initiate the Secure Payment Confirmation (SPC) process to securely authenticate the payment.'
                    },
                    step3: {
                        title: 'Step 3: Backend Prepares SPC Data',
                        p: 'The backend builds the <code>SecurePaymentConfirmationRequest</code> object, which contains the transaction details (like amount and payee) and the <code>challenge</code>. This data is sent to the frontend. The image above is just a visual mock.'
                    },
                    step4: {
                        title: 'Step 4: Calling PaymentRequest.show() with SPC',
                        p: 'The frontend uses the <code>PaymentRequest API</code> with the <code>"secure-payment-confirmation"</code> method. The API displays the browser\'s native interface to the user, who signs the transaction with their passkey. This creates a dynamic link, proving that the user consented to the transaction and not just logged in.'
                    },
                    step5: {
                        title: 'Step 5: User Biometric Authentication',
                        p: 'In this step, the browser displays the native authentication interface, such as Face ID, Touch ID, or Android fingerprint. The passkey is used to create a digital signature of the transaction, which will be sent back to the server.'
                    },
                    step6: {
                        title: 'Step 6: Backend Verifies the Signature',
                        p: 'The backend receives the payment response, which contains a WebAuthn assertion. The verification is similar to a login, but the backend also checks that the transaction data in the <code>clientDataJSON</code> matches the data it generated. If everything is correct, the payment is processed and the flow is completed.'
                    }
                },
                details: {
                    title: 'Technical Details',
                    p1: 'WebAuthn and SPC operations depend on specific data structures. The tables below detail the key parameters. Hover over a row for a brief description.',
                    table1: {
                        title: 'Key WebAuthn Parameters',
                        col1: 'Parameter', col2: 'Applicability',
                        row1: { tooltip: 'The Relying Party identifier (usually your site\'s domain).', p: 'Creation, Authentication' },
                        row2: { tooltip: 'The user\'s unique identifier in your system, provided as an ArrayBuffer.', p: 'Creation' },
                        row3: { tooltip: 'A random and unique value generated by the server to prevent replay attacks.', p: 'Creation, Authentication' },
                        row4: { tooltip: 'Specifies the accepted public key algorithms (e.g., ES256).', p: 'Creation' },
                        row5: { tooltip: 'Requires the user to verify themselves (biometrics/PIN), not just be present.', p: 'Creation, Authentication' },
                        row6: { tooltip: 'Controls the browser UI, \'conditional\' allows for automatic filling.', p: 'Authentication' }
                    },
                    table2: {
                        title: 'SPC Request Data Fields',
                        col1: 'Field', col2: 'Required',
                        row1: { tooltip: 'A cryptographic random value provided by the server.', p: 'Required' },
                        row2: { tooltip: 'A list of registered WebAuthn credential IDs for the payment.', p: 'Required' },
                        row3: { tooltip: 'The display name of the payment instrument (e.g., \'Visa **** 1234\').', p: 'Required' },
                        row4: { tooltip: 'The URL of the payment instrument\'s icon (e.g., brand logo).', p: 'Required' },
                        row5: { tooltip: 'The display name of the payee (the merchant).', p: 'Optional' },
                        row6: { tooltip: 'The origin (domain) of the payee.', p: 'Optional' }
                    }
                },
                security: {
                    title: 'Security Considerations',
                    p1: 'The implementation of passkeys and SPC requires attention to critical security details to protect users and transactions. The most important principle is the mitigation of replay attacks.',
                    card: {
                        title: 'Mitigating Replay Attacks with `challenge`',
                        p1: 'The `challenge` is the main defense against replay attacks, where an attacker intercepts an authentication response and reuses it.',
                        li1: '<strong>Unique per Request:</strong> The backend MUST generate a new cryptographically secure `challenge` for each registration or authentication attempt.',
                        li2: '<strong>Short Validity:</strong> The `challenge` must be stored in the user\'s session and have a short lifespan (a few minutes).',
                        li3: '<strong>Single Use:</strong> Once a `challenge` is used (whether in a successful or failed attempt), it MUST be immediately invalidated on the backend so it cannot be used again.',
                        p2: 'Using a FIDO server-side library (like SimpleWebAuthn) helps to manage these security requirements in a robust and reliable way.'
                    }
                }
            },
            es: {
                nav: {
                    intro: 'Introducci√≥n',
                    creation: 'Creaci√≥n de Passkey',
                    payment: 'Pago con SPC',
                    details: 'Detalles T√©cnicos',
                    security: 'Seguridad'
                },
                intro: {
                    title: 'Demostraci√≥n Interactiva de Passkeys para Pagos',
                    p1: 'Esta aplicaci√≥n traduce el informe t√©cnico sobre passkeys y Secure Payment Confirmation (SPC) en una experiencia interactiva. El objetivo es desmitificar los flujos de creaci√≥n y uso de passkeys en contextos de pago, proporcionando una visi√≥n clara de la interacci√≥n entre el frontend, el backend y el navegador. Navega por las secciones para explorar cada paso del proceso.',
                    card1: {
                        title: '¬øQu√© son las Passkeys?',
                        p: 'Una alternativa segura y resistente al phishing a las contrase√±as. Basadas en el est√°ndar WebAuthn, utilizan criptograf√≠a de clave p√∫blica y permiten la autenticaci√≥n con biometr√≠a o un PIN del dispositivo, eliminando la necesidad de contrase√±as tradicionales.'
                    },
                    card2: {
                        title: '¬øQu√© es SPC?',
                        p: 'Secure Payment Confirmation es una API web que extiende WebAuthn. Est√° dise√±ada para autenticar transacciones, proporcionando una prueba criptogr√°fica de que el usuario ha consentido los detalles espec√≠ficos de un pago (monto, beneficiario), y no solo que ha iniciado sesi√≥n.'
                    }
                },
                creation: {
                    title: 'Creaci√≥n de Passkey',
                    p1: 'Esta secci√≥n describe el recorrido del usuario para crear una passkey en su dispositivo. El proceso asegura que la cuenta del usuario est√© asociada de forma segura a una nueva credencial criptogr√°fica, reemplazando la necesidad de contrase√±as. Usa la simulaci√≥n a continuaci√≥n para explorar el flujo paso a paso.',
                    screen1: {
                        title: 'Creaci√≥n de Passkey',
                        p: '¬°Bienvenido! Haz clic en el bot√≥n de abajo para iniciar el proceso de creaci√≥n de tu passkey.',
                        btn: 'Crear Passkey'
                    },
                    explanation1: {
                        title: 'Inicio del Proceso',
                        p: 'Haz clic en "Crear Passkey" en el m√≥vil para comenzar la simulaci√≥n del flujo. Cada paso actualizar√° esta √°rea con una explicaci√≥n detallada y c√≥digo de ejemplo.'
                    },
                    step1: {
                        title: 'Paso 1: El Frontend Inicia el Registro',
                        p: 'El viaje comienza con el usuario interactuando con la interfaz. El frontend, en respuesta a esta acci√≥n, realiza una llamada de red al backend para obtener los par√°metros necesarios para la creaci√≥n de la passkey. Este es el primer paso para garantizar la seguridad de la transacci√≥n.'
                    },
                    step2: {
                        title: 'Paso 2: El Backend Genera Opciones',
                        p: 'El backend tiene la responsabilidad cr√≠tica de generar las opciones para la creaci√≥n de la credencial. La pieza m√°s importante es el <code>challenge</code>, un b√∫fer de bytes aleatorio y criptogr√°ficamente seguro que evita ataques de repetici√≥n.'
                    },
                    step3: {
                        title: 'Paso 3: Llamada a navigator.credentials.create()',
                        p: 'Con las opciones del backend, el frontend invoca la API del navegador <code>navigator.credentials.create()</code>. El navegador muestra una interfaz nativa que pide la confirmaci√≥n del usuario (biometr√≠a, PIN o contrase√±a), lo que garantiza una experiencia segura y consistente.'
                    },
                    step4: {
                        title: 'Paso 4: El Backend Verifica y Almacena',
                        p: 'La credencial se env√≠a de vuelta al servidor, que la valida criptogr√°ficamente, verifica el <code>challenge</code> y almacena la clave p√∫blica en la base de datos. Este es el paso final que garantiza la seguridad e integridad del proceso de registro.'
                    }
                },
                payment: {
                    title: 'Pago con SPC',
                    p1: 'Aqu√≠, exploramos c√≥mo Secure Payment Confirmation (SPC) utiliza passkeys para autorizar transacciones. El enfoque est√° en la seguridad y la experiencia del usuario, asegurando que el consentimiento del pago sea expl√≠cito e inalterable. Usa la simulaci√≥n a continuaci√≥n para explorar el flujo paso a paso.',
                    screen1: {
                        title: 'Pagar con Passkey',
                        p: 'Haz clic en "Pagar con Passkey" en el m√≥vil para iniciar la simulaci√≥n de una transacci√≥n con SPC.',
                        btn: 'Pagar con Passkey'
                    },
                    explanation1: {
                        title: 'Inicio del Pago',
                        p: 'Haz clic en "Pagar con Passkey" en el m√≥vil para comenzar la simulaci√≥n del flujo de pago. Cada paso actualizar√° esta √°rea con una explicaci√≥n detallada y c√≥digo de ejemplo.'
                    },
                    step1: {
                        title: 'Paso 1: Acci√≥n del Usuario',
                        p: 'El flujo de pago comienza con el usuario iniciando la transacci√≥n. El frontend prepara la solicitud de pago y le pide al backend las opciones para SPC, incluyendo el token de seguridad (challenge) y los detalles de la transacci√≥n.'
                    },
                    step2: {
                        title: 'Paso 2: Visualizaci√≥n del Carrito',
                        p: 'El usuario revisa el carrito de compras. Esta pantalla simula la interfaz de tu sitio. Al hacer clic en "Finalizar Compra", el navegador iniciar√° el proceso de Secure Payment Confirmation (SPC) para autenticar el pago de forma segura.'
                    },
                    step3: {
                        title: 'Paso 3: El Backend Prepara los Datos de SPC',
                        p: 'El backend construye el objeto <code>SecurePaymentConfirmationRequest</code>, que contiene los detalles de la transacci√≥n (como el monto y el beneficiario) y el <code>challenge</code>. Estos datos se env√≠an al frontend. La imagen de arriba es solo una maqueta visual.'
                    },
                    step4: {
                        title: 'Paso 4: Llamada a PaymentRequest.show() con SPC',
                        p: 'El frontend utiliza la <code>PaymentRequest API</code> con el m√©todo <code>"secure-payment-confirmation"</code>. La API muestra la interfaz nativa del navegador al usuario, quien firma la transacci√≥n con su passkey. Esto crea un v√≠nculo din√°mico, demostrando que el usuario ha consentido la transacci√≥n y no solo ha iniciado sesi√≥n.'
                    },
                    step5: {
                        title: 'Paso 5: Autenticaci√≥n Biom√©trica del Usuario',
                        p: 'En este paso, el navegador muestra la interfaz de autenticaci√≥n nativa, como Face ID, Touch ID o la huella digital de Android. La passkey se utiliza para crear una firma digital de la transacci√≥n, que se enviar√° de vuelta al servidor.'
                    },
                    step6: {
                        title: 'Paso 6: El Backend Verifica la Firma',
                        p: 'El backend recibe la respuesta del pago, que contiene una aserci√≥n WebAuthn. La verificaci√≥n es similar a un inicio de sesi√≥n, pero el backend tambi√©n comprueba que los datos de la transacci√≥n en el <code>clientDataJSON</code> coincidan con los datos que √©l mismo gener√≥. Si todo es correcto, el pago se procesa y el flujo se completa.'
                    }
                },
                details: {
                    title: 'Detalles T√©cnicos',
                    p1: 'Las operaciones de WebAuthn y SPC dependen de estructuras de datos espec√≠ficas. Las tablas a continuaci√≥n detallan los par√°metros clave. Pasa el cursor sobre una fila para ver una breve descripci√≥n.',
                    table1: {
                        title: 'Par√°metros Clave de WebAuthn',
                        col1: 'Par√°metro', col2: 'Aplicabilidad',
                        row1: { tooltip: 'Identificador de la Parte Confiable (generalmente el dominio de tu sitio).', p: 'Creaci√≥n, Autenticaci√≥n' },
                        row2: { tooltip: 'Identificador √∫nico del usuario en tu sistema, proporcionado como un ArrayBuffer.', p: 'Creaci√≥n' },
                        row3: { tooltip: 'Un valor aleatorio y √∫nico generado por el servidor para prevenir ataques de repetici√≥n.', p: 'Creaci√≥n, Autenticaci√≥n' },
                        row4: { tooltip: 'Especifica los algoritmos de clave p√∫blica aceptados (ej: ES256).', p: 'Creaci√≥n' },
                        row5: { tooltip: 'Requiere que el usuario se verifique a s√≠ mismo (biometr√≠a/PIN), no solo que est√© presente.', p: 'Creaci√≥n, Autenticaci√≥n' },
                        row6: { tooltip: 'Controla la interfaz de usuario del navegador, \'conditional\' permite el autocompletado.', p: 'Autenticaci√≥n' }
                    },
                    table2: {
                        title: 'Campos de Datos de la Solicitud SPC',
                        col1: 'Campo', col2: 'Obligatorio',
                        row1: { tooltip: 'Un valor criptogr√°fico aleatorio proporcionado por el servidor.', p: 'Obligatorio' },
                        row2: { tooltip: 'Una lista de IDs de credenciales WebAuthn registradas para el pago.', p: 'Obligatorio' },
                        row3: { tooltip: 'El nombre de visualizaci√≥n del instrumento de pago (ej: \'Visa **** 1234\').', p: 'Obligatorio' },
                        row4: { tooltip: 'La URL del √≠cono del instrumento de pago (ej: logo de la marca).', p: 'Obligatorio' },
                        row5: { tooltip: 'El nombre de visualizaci√≥n del beneficiario (el comerciante).', p: 'Opcional' },
                        row6: { tooltip: 'El origen (dominio) del beneficiario.', p: 'Opcional' }
                    }
                },
                security: {
                    title: 'Consideraciones de Seguridad',
                    p1: 'La implementaci√≥n de passkeys y SPC requiere atenci√≥n a detalles de seguridad cr√≠ticos para proteger a los usuarios y las transacciones. El principio m√°s importante es la mitigaci√≥n de ataques de repetici√≥n.',
                    card: {
                        title: 'Mitigando Ataques de Repetici√≥n con `challenge`',
                        p1: 'El `challenge` es la principal defensa contra los ataques de repetici√≥n, donde un atacante intercepta una respuesta de autenticaci√≥n y la reutiliza.',
                        li1: '<strong>√önico por Solicitud:</strong> El backend DEBE generar un nuevo `challenge` criptogr√°ficamente seguro para cada intento de registro o autenticaci√≥n.',
                        li2: '<strong>Validez Corta:</strong> El `challenge` debe almacenarse en la sesi√≥n del usuario y tener una vida √∫til corta (unos pocos minutos).',
                        li3: '<strong>Uso √önico:</strong> Una vez que se utiliza un `challenge` (ya sea en un intento exitoso o fallido), DEBE ser invalidado inmediatamente en el backend para que no pueda volver a utilizarse.',
                        p2: 'Usar una biblioteca FIDO del lado del servidor (como SimpleWebAuthn) ayuda a gestionar estos requisitos de seguridad de forma robusta y fiable.'
                    }
                }
            }
        };

        let currentLang = 'pt';
        
        function updateContent() {
            const elements = document.querySelectorAll('[data-i18n]');
            elements.forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[currentLang] && key) {
                    const keys = key.split('.');
                    let text = translations[currentLang];
                    for (const k of keys) {
                        text = text[k];
                        if (!text) break;
                    }
                    if (text) {
                        el.innerHTML = text;
                    }
                }
            });

            const titleElements = document.querySelectorAll('[data-i18n-title]');
            titleElements.forEach(el => {
                const key = el.getAttribute('data-i18n-title');
                if (translations[currentLang] && key) {
                    const keys = key.split('.');
                    let text = translations[currentLang];
                    for (const k of keys) {
                        text = text[k];
                        if (!text) break;
                    }
                    if (text) {
                        el.setAttribute('title', text);
                    }
                }
            });

            // Update dynamic content within the simulation
            if (document.getElementById('creation').classList.contains('hidden') === false) {
                const step = creationSteps[creationStep];
                creationScreenContent.innerHTML = step.screen;
                creationScreenActions.innerHTML = step.actions;
                creationExplanation.innerHTML = step.explanation;
            }
             if (document.getElementById('payment').classList.contains('hidden') === false) {
                const step = paymentSteps[paymentStep];
                paymentScreenContent.innerHTML = step.screen;
                paymentScreenActions.innerHTML = step.actions;
                paymentExplanation.innerHTML = step.explanation;
            }
        }

        const languageButtons = document.querySelectorAll('.language-button');
        languageButtons.forEach(button => {
            button.addEventListener('click', () => {
                languageButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                currentLang = button.getAttribute('data-lang');
                updateContent();
            });
        });

        const sections = document.querySelectorAll('.content-section');
        const navLinks = document.querySelectorAll('.nav-link');
        const mobileNav = document.getElementById('mobile-nav');

        function setActiveSection(hash) {
            const targetHash = hash.startsWith('#') ? hash : `#${hash}`;
            
            sections.forEach(section => {
                if (`#${section.id}` === targetHash) {
                    section.classList.remove('hidden');
                } else {
                    section.classList.add('hidden');
                }
            });

            navLinks.forEach(link => {
                if (link.getAttribute('href') === targetHash) {
                    link.classList.add('sidebar-active');
                } else {
                    link.classList.remove('sidebar-active');
                }
            });
            
            if (mobileNav.value !== hash.substring(1)) {
                mobileNav.value = hash.substring(1);
            }
            
            window.scrollTo(0, 0);
        }

        function handleNavigation(event) {
            event.preventDefault();
            const targetHash = event.currentTarget.getAttribute('href');
            setActiveSection(targetHash);
            history.pushState(null, null, targetHash);
            updateContent();
        }

        navLinks.forEach(link => {
            link.addEventListener('click', handleNavigation);
        });

        mobileNav.addEventListener('change', (event) => {
            const targetHash = `#${event.target.value}`;
            setActiveSection(targetHash);
            history.pushState(null, null, targetHash);
            updateContent();
        });

        window.addEventListener('popstate', () => {
            const hash = window.location.hash || '#intro';
            setActiveSection(hash);
            updateContent();
        });
        
        document.addEventListener('DOMContentLoaded', () => {
            const hash = window.location.hash || '#intro';
            setActiveSection(hash);
            updateContent(); // Initial content load
        });
        
        const creationScreenContent = document.getElementById('creation-screen-content');
        const creationScreenActions = document.getElementById('creation-screen-actions');
        const creationExplanation = document.getElementById('creation-explanation');
        const creationProgressBar = document.getElementById('creation-progress-bar');
        let creationStep = 0;

        function updateCreationProgressBar(currentStep, totalSteps) {
            const percentage = ((currentStep + 1) / totalSteps) * 100;
            creationProgressBar.style.width = `${percentage}%`;
        }
        
        const createPasskeyText = translations.pt.creation.screen1.btn;
        const authenticateText = 'Autenticado';
        const restartSimText = 'Reiniciar Simula√ß√£o';
        
        const creationSteps = [
            {
                title: 'In√≠cio do Processo',
                screen: `
                    <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#A78BFA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-key-round mb-4"><path d="M2 18v2a2 2 0 0 0 2 2h4"/><path d="M15 22h2a2 2 0 0 0 2-2v-2"/><path d="M2 13v-2a2 2 0 0 1 2-2h10l3-3 3 3v2l-3 3h-2"/><path d="M7 11h2"/></svg>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2" data-i18n="creation.screen1.title">Cria√ß√£o de Passkey</h3>
                    <p class="text-gray-600" data-i18n="creation.screen1.p">Bem-vindo! Clique no bot√£o abaixo para iniciar o processo de cria√ß√£o da sua passkey.</p>
                `,
                actions: `
                    <button class="bg-[#A78BFA] text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-[#8B5CF6] transition-colors" onclick="nextCreationStep()" data-i18n="creation.screen1.btn">Criar Passkey</button>
                `,
                explanation: `
                    <h3 class="font-semibold text-lg text-gray-800" data-i18n="creation.explanation1.title">In√≠cio do Processo</h3>
                    <p class="text-gray-600 mt-2" data-i18n="creation.explanation1.p">Clique em "Criar Passkey" no celular para come√ßar a simula√ß√£o do fluxo. Cada passo ir√° atualizar esta √°rea com uma explica√ß√£o detalhada e c√≥digo de exemplo.</p>
                `
            },
            {
                title: 'Backend Gera Op√ß√µes',
                screen: `
                    <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#A78BFA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-server mb-4"><rect width="20" height="8" x="2" y="2" rx="2" ry="2"/><rect width="20" height="8" x="2" y="14" rx="2" ry="2"/><line x1="6" x2="6.01" y1="6" y2="6"/><line x1="6" x2="6.01" y1="18" y2="18"/></svg>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2" data-i18n="creation.step2.title">Conectando ao Servidor...</h3>
                    <p class="text-gray-600" data-i18n="creation.step2.p">O servidor est√° gerando um token de seguran√ßa √∫nico (challenge) e outras op√ß√µes para a sua passkey.</p>
                `,
                actions: `
                    <button class="bg-[#A78BFA] text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-[#8B5CF6] transition-colors" onclick="nextCreationStep()">Simular <code>navigator.credentials.create()</code></button>
                `,
                explanation: `
                    <h3 class="font-semibold text-lg text-gray-800" data-i18n="creation.step2.explanation.title">Passo 2: Backend Gera Op√ß√µes</h3>
                    <p class="text-gray-600 mt-2" data-i18n="creation.step2.explanation.p">O backend tem a responsabilidade cr√≠tica de gerar as op√ß√µes para a cria√ß√£o da credencial. A pe√ßa mais importante √© o <code>challenge</code>, um buffer de bytes aleat√≥rios e criptograficamente seguro que previne ataques de repeti√ß√£o.</p>
                    <pre><code class="language-js"><span class="code-comment">// Exemplo de l√≥gica de backend (usando uma biblioteca FIDO)</span>
<span class="code-keyword">import</span> { <span class="code-variable">generateRegistrationOptions</span> } <span class="code-keyword">from</span> <span class="code-string">'@simplewebauthn/server'</span>;
<span class="code-keyword">const</span> <span class="code-variable">options</span> = <span class="code-keyword">await</span> <span class="code-function">generateRegistrationOptions</span>({
  <span class="code-variable">rpID</span>: <span class="code-string">'example.com'</span>,
  <span class="code-variable">rpName</span>: <span class="code-string">'My Awesome App'</span>,
  <span class="code-variable">userID</span>: <span class="code-string">'user-unique-id'</span>,
  <span class="code-variable">userName</span>: <span class="code-string">'user@example.com'</span>,
});
<span class="code-comment">// O backend deve salvar 'options.challenge' na sess√£o do usu√°rio</span>
                    </code></pre>
                `
            },
            {
                title: 'Confirma√ß√£o do Usu√°rio',
                screen: `
                    <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#A78BFA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-fingerprint mb-4"><path d="M2 12C2 6.5 6.5 2 12 2a10 10 0 0 1 8 4"/><path d="M5 12C5 8.1 8.1 5 12 5c2.6 0 4.8.8 6.7 2.2"/><path d="M12 12v10"/><path d="M12 12c-1.4 0-2.7.4-4.4 1.3"/><path d="M14 10a2 2 0 0 1 2 2c0 2-1 3-1 3"/><path d="M16 12h2"/><path d="M22 12a10 10 0 0 1-2 6"/><path d="M15 22v-4a2 2 0 0 0-2-2"/><path d="M12 17c-1 0-2.4-.6-4-1.3"/><path d="M20 15v-3"/></svg>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2" data-i18n="creation.step3.title">Confirme sua Passkey</h3>
                    <p class="text-gray-600" data-i18n="creation.step3.p">O navegador est√° solicitando sua confirma√ß√£o. Use sua biometria, PIN ou senha para autorizar.</p>
                `,
                actions: `
                    <button class="bg-[#34D399] text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-[#10B981] transition-colors" onclick="nextCreationStep()" data-i18n="creation.step3.btn">Autenticado</button>
                `,
                explanation: `
                    <h3 class="font-semibold text-lg text-gray-800" data-i18n="creation.step3.explanation.title">Passo 3: Chamada <code>navigator.credentials.create()</code></h3>
                    <p class="text-gray-600 mt-2" data-i18n="creation.step3.explanation.p">Com as op√ß√µes do backend, o frontend invoca a API do navegador <code>navigator.credentials.create()</code>. O navegador ent√£o exibe uma interface nativa que pede a confirma√ß√£o do usu√°rio (biometria, PIN ou senha), garantindo uma experi√™ncia segura e consistente.</p>
                    <pre><code class="language-js"><span class="code-comment">// Frontend recebe 'options' do backend e chama a API</span>
<span class="code-keyword">let</span> <span class="code-variable">newCredential</span>;
<span class="code-keyword">try</span> {
  <span class="code-variable">newCredential</span> = <span class="code-keyword">await</span> <span class="code-variable">navigator</span>.<span class="code-variable">credentials</span>.<span class="code-function">create</span>({
    <span class="code-variable">publicKey</span>: <span class="code-variable">options</span>
  });
} <span class="code-keyword">catch</span> (e) {
  <span class="code-comment">// Lidar com erros, como o usu√°rio cancelar a opera√ß√£o</span>
}
                    </code></pre>
                `
            },
            {
                title: 'Sucesso',
                screen: `
                    <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#34D399" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check-circle mb-4"><path d="M22 11.08V12a10 10 0 1 1-5.93-8.62"/><path d="m9 11 3 3L22 4"/></svg>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2" data-i18n="creation.step4.title">Passkey Criada!</h3>
                    <p class="text-gray-600" data-i18n="creation.step4.p">Sua nova passkey foi criada e est√° pronta para ser usada de forma segura.</p>
                `,
                actions: `
                    <button class="bg-gray-300 text-gray-800 font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-gray-400 transition-colors" onclick="resetCreationSimulation()" data-i18n="creation.step4.btn">Reiniciar Simula√ß√£o</button>
                `,
                explanation: `
                    <h3 class="font-semibold text-lg text-gray-800" data-i18n="creation.step4.explanation.title">Passo 4: Backend Verifica e Armazena</h3>
                    <p class="text-gray-600 mt-2" data-i18n="creation.step4.explanation.p">A credencial √© enviada de volta ao servidor, que a valida criptograficamente, verifica o <code>challenge</code> e armazena a chave p√∫blica no banco de dados. Este √© o passo final que garante a seguran√ßa e integridade do processo de registro.</p>
                    <pre><code class="language-js"><span class="code-comment">// Exemplo de verifica√ß√£o no backend</span>
<span class="code-keyword">import</span> { <span class="code-variable">verifyRegistrationResponse</span> } <span class="code-keyword">from</span> <span class="code-string">'@simplewebauthn/server'</span>;
<span class="code-keyword">const</span> <span class="code-variable">verification</span> = <span class="code-keyword">await</span> <span class="code-function">verifyRegistrationResponse</span>({
  <span class="code-variable">response</span>: <span class="code-variable">newCredential</span>,
  <span class="code-variable">expectedChallenge</span>: <span class="code-variable">userSession</span>.<span class="code-variable">currentChallenge</span>,
  <span class="code-variable">expectedOrigin</span>: <span class="code-string">'https://example.com'</span>,
});
                    </code></pre>
                `
            }
        ];

        function nextCreationStep() {
            creationStep = (creationStep + 1) % creationSteps.length;
            const step = creationSteps[creationStep];
            creationScreenContent.classList.remove('animate-fade-in');
            void creationScreenContent.offsetWidth; // Trigger reflow
            creationScreenContent.innerHTML = step.screen;
            creationScreenActions.innerHTML = step.actions;
            creationExplanation.innerHTML = step.explanation;
            creationScreenContent.classList.add('animate-fade-in');
            updateCreationProgressBar(creationStep, creationSteps.length);
            updateContent();
        }

        function resetCreationSimulation() {
            creationStep = -1;
            nextCreationStep();
        }
        
        const paymentScreenContent = document.getElementById('payment-screen-content');
        const paymentScreenActions = document.getElementById('payment-screen-actions');
        const paymentExplanation = document.getElementById('payment-explanation');
        const paymentProgressBar = document.getElementById('payment-progress-bar');
        let paymentStep = 0;

        function updatePaymentProgressBar(currentStep, totalSteps) {
            const bar = document.getElementById('payment-progress-bar');
            const percentage = ((currentStep + 1) / totalSteps) * 100;
            bar.style.width = `${percentage}%`;
        }

        const paymentSteps = [
            {
                title: 'In√≠cio do Pagamento',
                screen: `
                    <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#34D399" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-credit-card mb-4"><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></svg>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2" data-i18n="payment.screen1.title">Pagar com Passkey</h3>
                    <p class="text-gray-600" data-i18n="payment.screen1.p">Clique em "Pagar com Passkey" no celular para iniciar a simula√ß√£o de uma transa√ß√£o com SPC.</p>
                `,
                actions: `
                    <button class="bg-[#34D399] text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-[#10B981] transition-colors" onclick="nextPaymentStep()" data-i18n="payment.screen1.btn">Pagar com Passkey</button>
                `,
                explanation: `
                    <h3 class="font-semibold text-lg text-gray-800" data-i18n="payment.explanation1.title">In√≠cio do Pagamento</h3>
                    <p class="text-gray-600 mt-2" data-i18n="payment.explanation1.p">Clique em "Pagar com Passkey" no celular para come√ßar a simula√ß√£o do fluxo de pagamento. Cada passo ir√° atualizar esta √°rea com uma explica√ß√£o detalhada e c√≥digo de exemplo.</p>
                `
            },
            {
                title: 'Carrinho de Compras',
                screen: `
                    <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#34D399" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shopping-cart mb-4"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.5 2h1.5l4.5 12.5c.3.8.9 1.5 1.7 1.7L19 19H8"/></svg>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2" data-i18n="payment.step2.title">Carrinho de Compras</h3>
                    <div class="grid grid-cols-2 gap-4 mt-4 w-full text-left">
                        <img src="https://placehold.co/100x100/A78BFA/ffffff?text=Produto" alt="Produto" class="rounded-lg">
                        <div>
                            <h4 class="font-semibold">Decov Shop</h4>
                            <p class="text-sm text-gray-600">Tapete decorativo premium</p>
                            <p class="font-bold text-lg mt-1">R$ 59,99</p>
                        </div>
                    </div>
                `,
                actions: `
                    <button class="bg-[#34D399] text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-[#10B981] transition-colors" onclick="nextPaymentStep()" data-i18n="payment.step2.btn">Finalizar Compra</button>
                `,
                explanation: `
                    <h3 class="font-semibold text-lg text-gray-800" data-i18n="payment.step2.explanation.title">Passo 2: Exibi√ß√£o do Carrinho</h3>
                    <p class="text-gray-600 mt-2" data-i18n="payment.step2.explanation.p">O usu√°rio revisa o carrinho de compras. Esta tela simula a interface do seu site. Ao clicar em "Finalizar Compra", o navegador iniciar√° o processo de Secure Payment Confirmation (SPC) para autenticar o pagamento de forma segura.</p>
                `
            },
            {
                title: 'Detalhes do Pedido',
                screen: `
                    <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#34D399" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-server mb-4"><rect width="20" height="8" x="2" y="2" rx="2" ry="2"/><rect width="20" height="8" x="2" y="14" rx="2" ry="2"/><line x1="6" x2="6.01" y1="6" y2="6"/><line x1="6" x2="6.01" y1="18" y2="18"/></svg>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2" data-i18n="payment.step3.title">Conectando ao Servidor...</h3>
                    <p class="text-gray-600" data-i18n="payment.step3.p">O servidor est√° preparando os detalhes da transa√ß√£o para o SPC.</p>
                `,
                actions: `
                    <button class="bg-[#34D399] text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-[#10B981] transition-colors" onclick="nextPaymentStep()">Simular <code>PaymentRequest.show()</code></button>
                `,
                explanation: `
                    <h3 class="font-semibold text-lg text-gray-800" data-i18n="payment.step3.explanation.title">Passo 3: Backend Prepara Dados SPC</h3>
                    <p class="text-gray-600 mt-2" data-i18n="payment.step3.explanation.p">O backend constr√≥i o objeto <code>SecurePaymentConfirmationRequest</code>, que cont√©m os detalhes da transa√ß√£o (como valor e benefici√°rio) e o <code>challenge</code>. Estes dados s√£o enviados para o frontend. A imagem acima √© apenas um mock visual.</p>
                    <pre><code class="language-js"><span class="code-comment">// Exemplo de l√≥gica de backend para gerar as op√ß√µes de pagamento</span>
<span class="code-keyword">const</span> <span class="code-variable">paymentOptions</span> = {
  <span class="code-variable">rp</span>: { <span class="code-variable">id</span>: <span class="code-string">'lojaonline.com'</span>, <span class="code-variable">name</span>: <span class="code-string">'Minha Loja Online'</span> },
  <span class="code-variable">challenge</span>: <span class="code-variable">crypto</span>.<span class="code-function">randomUUID</span>(),
  <span class="code-variable">instrument</span>: {
    <span class="code-variable">displayName</span>: <span class="code-string">'Visa **** 1234'</span>,
    <span class="code-variable">icon</span>: <span class="code-string">'https://lojaonline.com/visa.svg'</span>
  },
  <span class="code-variable">payeeName</span>: <span class="code-string">'Minha Loja Online'</span>
};
<span class="code-comment">// O backend deve salvar paymentOptions.challenge na sess√£o</span>
                    </code></pre>
                `
            },
            {
                title: 'Confirma√ß√£o de Pagamento',
                screen: `
                    <div class="flex-1 flex flex-col justify-center items-center text-center p-4">
                        <div class="p-6 bg-white rounded-2xl shadow-xl w-64 text-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#A78BFA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-wallet mb-4"><path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1h-3m-6 0v4a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-2"/><path d="M22 7V4a1 1 0 0 0-1-1H3a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h18a1 1 0 0 0 1-1z"/><path d="M3 11v-1a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v1"/><line x1="12" x2="12" y1="12" y2="12"/></svg>
                            <p class="mt-4 font-semibold text-lg text-gray-800" data-i18n="payment.step4.title">Pagar R$ 59,99 para a Loja Online?</p>
                            <div class="mt-4 flex flex-col space-y-2 text-sm text-gray-600">
                                <p data-i18n="payment.step4.p">Use sua passkey para confirmar a compra de forma segura.</p>
                            </div>
                        </div>
                    </div>
                `,
                actions: `
                    <button class="bg-[#A78BFA] text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-[#8B5CF6] transition-colors" onclick="nextPaymentStep()" data-i18n="payment.step4.btn">Confirmar</button>
                `,
                explanation: `
                    <h3 class="font-semibold text-lg text-gray-800" data-i18n="payment.step4.explanation.title">Passo 4: Chamada <code>PaymentRequest.show()</code> com SPC</h3>
                    <p class="text-gray-600 mt-2" data-i18n="payment.step4.explanation.p">O frontend usa a <code>PaymentRequest API</code> com o m√©todo <code>"secure-payment-confirmation"</code>. A API exibe a interface nativa do navegador para o usu√°rio, que assina a transa√ß√£o com sua passkey. Isso cria um v√≠nculo din√¢mico, provando que o usu√°rio consentiu com a transa√ß√£o e n√£o apenas fez login.</p>
                    <pre><code class="language-js"><span class="code-comment">// Frontend recebe 'paymentOptions' do backend e chama a API</span>
<span class="code-keyword">const</span> <span class="code-variable">paymentMethods</span> = [{
  <span class="code-variable">supportedMethods</span>: <span class="code-string">'secure-payment-confirmation'</span>,
  <span class="code-variable">data</span>: <span class="code-variable">paymentOptions</span>
}];
<span class="code-keyword">const</span> <span class="code-variable">request</span> = <span class="code-keyword">new</span> <span class="code-function">PaymentRequest</span>(<span class="code-variable">paymentMethods</span>, <span class="code-variable">details</span>);
<span class="code-keyword">const</span> <span class="code-variable">response</span> = <span class="code-keyword">await</span> <span class="code-variable">request</span>.<span class="code-function">show</span>();
                    </code></pre>
                `
            },
            {
                title: 'Autentica√ß√£o Biom√©trica',
                screen: `
                    <div class="flex flex-col items-center justify-center flex-1">
                        <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#A78BFA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-fingerprint mb-6"><path d="M2 12C2 6.5 6.5 2 12 2a10 10 0 0 1 8 4"/><path d="M5 12C5 8.1 8.1 5 12 5c2.6 0 4.8.8 6.7 2.2"/><path d="M12 12v10"/><path d="M12 12c-1.4 0-2.7.4-4.4 1.3"/><path d="M14 10a2 2 0 0 1 2 2c0 2-1 3-1 3"/><path d="M16 12h2"/><path d="M22 12a10 10 0 0 1-2 6"/><path d="M15 22v-4a2 2 0 0 0-2-2"/><path d="M12 17c-1 0-2.4-.6-4-1.3"/><path d="M20 15v-3"/></svg>
                        <h3 class="text-xl font-semibold text-gray-800" data-i18n="payment.step5.title">Confirme com biometria</h3>
                        <p class="text-gray-600 mt-2" data-i18n="payment.step5.p">Use sua digital ou Face ID para autorizar.</p>
                    </div>
                `,
                actions: `
                    <button class="bg-[#34D399] text-white py-3 px-6 rounded-lg shadow-md hover:bg-[#10B981] transition-colors" onclick="nextPaymentStep()" data-i18n="payment.step5.btn">Usar Biometria</button>
                `,
                explanation: `
                    <h3 class="font-semibold text-lg text-gray-800" data-i18n="payment.step5.explanation.title">Passo 5: Autentica√ß√£o Biom√©trica do Usu√°rio</h3>
                    <p class="text-gray-600 mt-2" data-i18n="payment.step5.explanation.p">Nesta etapa, o navegador exibe a interface de autentica√ß√£o nativa, como Face ID, Touch ID ou a digital do Android. A passkey √© usada para criar uma assinatura digital da transa√ß√£o, que ser√° enviada de volta ao servidor.</p>
                `
            },
            {
                title: 'Pagamento Conclu√≠do',
                screen: `
                    <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#34D399" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check-circle mb-4"><path d="M22 11.08V12a10 10 0 1 1-5.93-8.62"/><path d="m9 11 3 3L22 4"/></svg>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2" data-i18n="payment.step6.title">Pagamento Autorizado!</h3>
                    <p class="text-gray-600" data-i18n="payment.step6.p">Sua transa√ß√£o foi confirmada com sucesso de forma segura usando passkey.</p>
                `,
                actions: `
                    <button class="bg-gray-300 text-gray-800 font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-gray-400 transition-colors" onclick="resetPaymentSimulation()" data-i18n="payment.step6.btn">Reiniciar Simula√ß√£o</button>
                `,
                explanation: `
                    <h3 class="font-semibold text-lg text-gray-800" data-i18n="payment.step6.explanation.title">Passo 6: Backend Verifica a Assinatura</h3>
                    <p class="text-gray-600 mt-2" data-i18n="payment.step6.explanation.p">O backend recebe a resposta do pagamento, que cont√©m uma asser√ß√£o WebAuthn. A verifica√ß√£o √© similar a um login, mas o backend tamb√©m verifica se os dados da transa√ß√£o no <code>clientDataJSON</code> correspondem aos dados que ele mesmo gerou. Se tudo estiver correto, o pagamento √© processado e o fluxo √© conclu√≠do.</p>
                    <pre><code class="language-js"><span class="code-comment">// Exemplo de verifica√ß√£o no backend</span>
<span class="code-keyword">import</span> { <span class="code-variable">verifyRegistrationResponse</span> } <span class="code-keyword">from</span> <span class="code-string">'@simplewebauthn/server'</span>;
<span class="code-keyword">const</span> <span class="code-variable">verification</span> = <span class="code-keyword">await</span> <span class="code-function">verifyRegistrationResponse</span>({
  <span class="code-variable">response</span>: <span class="code-variable">paymentResponse</span>,
  <span class="code-variable">expectedChallenge</span>: <span class="code-variable">userSession</span>.<span class="code-variable">currentChallenge</span>,
  <span class="code-variable">expectedOrigin</span>: <span class="code-string">'https://lojaonline.com'</span>,
  <span class="code-variable">paymentData</span>: <span class="code-variable">expectedPaymentData</span>
});
                    </code></pre>
                `
            }
        ];

        function nextPaymentStep() {
            paymentStep = (paymentStep + 1) % paymentSteps.length;
            const step = paymentSteps[paymentStep];
            
            paymentScreenContent.classList.remove('animate-fade-in');
            void paymentScreenContent.offsetWidth; // Trigger reflow
            paymentScreenContent.innerHTML = step.screen;
            paymentScreenActions.innerHTML = step.actions;
            paymentExplanation.innerHTML = step.explanation;
            paymentScreenContent.classList.add('animate-fade-in');
            
            updatePaymentProgressBar(paymentStep, paymentSteps.length);
            updateContent();
        }
        
        function resetPaymentSimulation() {
            paymentStep = -1;
            nextPaymentStep();
        }

        // Add placeholders for translated strings in the mobile dropdown
        const mobileNavOptions = mobileNav.querySelectorAll('option');
        mobileNavOptions.forEach(option => {
            option.setAttribute('data-i18n', `nav.${option.value}`);
        });
    </script>
</body>
</html>
