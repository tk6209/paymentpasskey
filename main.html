<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo Interativa: Passkeys para Pagamentos com SPC</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FDFBF8;
            color: #4B5563;
        }
        .sidebar-active {
            background-color: #EAE6E1;
            color: #1F2937;
            font-weight: 600;
        }
        .phone-mockup {
            width: 320px;
            height: 640px;
            background: #1F2937;
            border-radius: 36px;
            padding: 10px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            display: flex;
            flex-direction: column;
            position: relative;
        }
        .phone-screen {
            flex: 1;
            background: white;
            border-radius: 26px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .phone-header {
            background: #E5E7EB;
            padding: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .code-keyword { color: #A78BFA; }
        .code-function { color: #60A5FA; }
        .code-string { color: #FBBF24; }
        .code-comment { color: #9CA3AF; }
        .code-variable { color: #34D399; }
        pre {
            background-color: #1F2937;
            color: #E5E7EB;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            font-size: 0.875rem;
            margin-top: 1rem;
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body class="antialiased">

    <div class="flex min-h-screen">
        <aside class="w-64 bg-[#F5F1EC] p-6 hidden lg:block sticky top-0 h-screen">
            <h1 class="text-xl font-bold text-gray-800 mb-8">Passkeys & Pagamentos</h1>
            <nav id="sidebar-nav">
                <a href="#intro" class="nav-link flex items-center px-4 py-3 rounded-lg text-gray-700 hover:bg-[#EAE6E1]">
                    <span class="mr-3">üëã</span> Introdu√ß√£o
                </a>
                <a href="#creation" class="nav-link flex items-center px-4 py-3 mt-2 rounded-lg text-gray-700 hover:bg-[#EAE6E1]">
                    <span class="mr-3">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-key-round"><path d="M2 18v2a2 2 0 0 0 2 2h4"/><path d="M15 22h2a2 2 0 0 0 2-2v-2"/><path d="M2 13v-2a2 2 0 0 1 2-2h10l3-3 3 3v2l-3 3h-2"/><path d="M7 11h2"/></svg>
                    </span> Cria√ß√£o de Passkey
                </a>
                <a href="#payment" class="nav-link flex items-center px-4 py-3 mt-2 rounded-lg text-gray-700 hover:bg-[#EAE6E1]">
                    <span class="mr-3">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-credit-card"><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></svg>
                    </span> Pagamento com SPC
                </a>
                <a href="#details" class="nav-link flex items-center px-4 py-3 mt-2 rounded-lg text-gray-700 hover:bg-[#EAE6E1]">
                    <span class="mr-3">‚öôÔ∏è</span> Detalhes T√©cnicos
                </a>
                <a href="#security" class="nav-link flex items-center px-4 py-3 mt-2 rounded-lg text-gray-700 hover:bg-[#EAE6E1]">
                    <span class="mr-3">üõ°Ô∏è</span> Seguran√ßa
                </a>
            </nav>
        </aside>

        <main class="flex-1 p-4 sm:p-6 md:p-10">
            <div class="max-w-4xl mx-auto">
                <div class="lg:hidden mb-6">
                    <select id="mobile-nav" class="w-full p-3 border border-gray-300 rounded-lg bg-white">
                        <option value="intro">Introdu√ß√£o</option>
                        <option value="creation">Cria√ß√£o de Passkey</option>
                        <option value="payment">Pagamento com SPC</option>
                        <option value="details">Detalhes T√©cnicos</option>
                        <option value="security">Seguran√ßa</option>
                    </select>
                </div>

                <section id="intro" class="content-section">
                    <h2 class="text-3xl font-bold text-gray-900 mb-4">Demonstra√ß√£o Interativa de Passkeys para Pagamentos</h2>
                    <p class="text-lg text-gray-600 mb-6">Esta aplica√ß√£o traduz o relat√≥rio t√©cnico sobre passkeys e Secure Payment Confirmation (SPC) em uma experi√™ncia interativa. O objetivo √© desmistificar os fluxos de cria√ß√£o e uso de passkeys em contextos de pagamento, fornecendo uma vis√£o clara da intera√ß√£o entre frontend, backend e navegador. Navegue pelas se√ß√µes para explorar cada etapa do processo.</p>
                    <div class="grid md:grid-cols-2 gap-6 mt-8">
                        <div class="bg-white p-6 rounded-xl border border-gray-200">
                            <h3 class="font-semibold text-lg text-gray-800 mb-2">O que s√£o Passkeys?</h3>
                            <p class="text-gray-600">Uma alternativa segura e resistente a phishing √†s senhas. Baseadas no padr√£o WebAuthn, usam criptografia de chave p√∫blica e permitem autentica√ß√£o com biometria ou PIN do dispositivo, eliminando a necessidade de senhas tradicionais.</p>
                        </div>
                        <div class="bg-white p-6 rounded-xl border border-gray-200">
                            <h3 class="font-semibold text-lg text-gray-800 mb-2">O que √© SPC?</h3>
                            <p class="text-gray-600">Secure Payment Confirmation √© uma API web que estende o WebAuthn. Ela foi projetada para autenticar transa√ß√µes, fornecendo prova criptogr√°fica de que o usu√°rio consentiu com os detalhes espec√≠ficos de um pagamento (valor, benefici√°rio), e n√£o apenas que fez login.</p>
                        </div>
                    </div>
                </section>
                
                <section id="creation" class="content-section hidden">
                    <h2 class="text-3xl font-bold text-gray-900 mb-2">Cria√ß√£o de Passkey</h2>
                    <p class="text-lg text-gray-600 mb-8">Esta se√ß√£o descreve a jornada do usu√°rio para criar uma passkey em seu dispositivo. O processo garante que a conta do usu√°rio seja associada de forma segura a uma nova credencial criptogr√°fica, substituindo a necessidade de senhas. Use a simula√ß√£o abaixo para explorar o fluxo passo a passo.</p>
                    <div class="flex flex-col lg:flex-row gap-8">
                        <div class="flex-1">
                            <div class="phone-mockup mx-auto lg:mx-0">
                                <div class="phone-header rounded-t-xl text-gray-600">
                                    <span class="text-xs">9:41</span>
                                    <div class="w-12 h-4 bg-gray-800 rounded-b-xl -mt-1 mx-2"></div>
                                    <span class="text-xs">üì∂ üîã</span>
                                </div>
                                <div id="creation-phone-screen" class="phone-screen p-4 flex flex-col justify-between relative">
                                     <div class="w-full bg-gray-200 rounded-full h-2 mb-4">
                                        <div id="creation-progress-bar" class="bg-[#A78BFA] h-2 rounded-full transition-all duration-500 ease-in-out" style="width: 0%"></div>
                                    </div>
                                    <div id="creation-screen-content" class="text-center flex-1 flex flex-col items-center justify-center animate-fade-in">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#A78BFA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-key-round mb-4"><path d="M2 18v2a2 2 0 0 0 2 2h4"/><path d="M15 22h2a2 2 0 0 0 2-2v-2"/><path d="M2 13v-2a2 2 0 0 1 2-2h10l3-3 3 3v2l-3 3h-2"/><path d="M7 11h2"/></svg>
                                        <h3 class="text-xl font-semibold text-gray-800 mb-2">Cria√ß√£o de Passkey</h3>
                                        <p class="text-gray-600">Bem-vindo! Clique no bot√£o abaixo para iniciar o processo de cria√ß√£o da sua passkey.</p>
                                    </div>
                                    <div id="creation-screen-actions" class="flex flex-col space-y-4">
                                        <button class="bg-[#A78BFA] text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-[#8B5CF6] transition-colors" onclick="nextCreationStep()">Criar Passkey</button>
                                    </div>
                                </div>
                                <div class="h-4 bg-black rounded-b-3xl"></div>
                            </div>
                        </div>
                        <div id="creation-explanation" class="flex-1 bg-white p-6 rounded-xl border border-gray-200">
                            <h3 class="font-semibold text-lg text-gray-800">In√≠cio do Processo</h3>
                            <p class="text-gray-600 mt-2">Clique em "Criar Passkey" no celular para come√ßar a simula√ß√£o do fluxo. Cada passo ir√° atualizar esta √°rea com uma explica√ß√£o detalhada e c√≥digo de exemplo.</p>
                        </div>
                    </div>
                </section>

                <section id="payment" class="content-section hidden">
                    <h2 class="text-3xl font-bold text-gray-900 mb-2">Pagamento com SPC</h2>
                    <p class="text-lg text-gray-600 mb-8">Aqui, exploramos como o Secure Payment Confirmation (SPC) utiliza passkeys para autorizar transa√ß√µes. O foco √© na seguran√ßa e na experi√™ncia do usu√°rio, garantindo que o consentimento do pagamento seja expl√≠cito e √† prova de adultera√ß√£o. Use a simula√ß√£o abaixo para explorar o fluxo passo a passo.</p>
                    <div class="flex flex-col lg:flex-row gap-8">
                        <div class="flex-1">
                            <div class="phone-mockup mx-auto lg:mx-0">
                                <div class="phone-header rounded-t-xl text-gray-600">
                                    <span class="text-xs">9:41</span>
                                    <div class="w-12 h-4 bg-gray-800 rounded-b-xl -mt-1 mx-2"></div>
                                    <span class="text-xs">üì∂ üîã</span>
                                </div>
                                <div id="payment-phone-screen" class="phone-screen p-4 flex flex-col justify-between relative">
                                    <div class="w-full bg-gray-200 rounded-full h-2 mb-4">
                                        <div id="payment-progress-bar" class="bg-[#34D399] h-2 rounded-full transition-all duration-500 ease-in-out" style="width: 0%"></div>
                                    </div>
                                    <div id="payment-screen-content" class="text-center flex-1 flex flex-col items-center justify-center animate-fade-in">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#34D399" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-credit-card mb-4"><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></svg>
                                        <h3 class="text-xl font-semibold text-gray-800 mb-2">Pagar com Passkey</h3>
                                        <p class="text-gray-600">Clique em "Pagar com Passkey" no celular para iniciar a simula√ß√£o de uma transa√ß√£o com SPC.</p>
                                    </div>
                                    <div id="payment-screen-actions" class="flex flex-col space-y-4">
                                        <button class="bg-[#34D399] text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-[#10B981] transition-colors" onclick="nextPaymentStep()">Pagar com Passkey</button>
                                    </div>
                                </div>
                                <div class="h-4 bg-black rounded-b-3xl"></div>
                            </div>
                        </div>
                        <div id="payment-explanation" class="flex-1 bg-white p-6 rounded-xl border border-gray-200">
                            <h3 class="font-semibold text-lg text-gray-800">In√≠cio do Pagamento</h3>
                            <p class="text-gray-600 mt-2">Clique em "Pagar com Passkey" no celular para come√ßar a simula√ß√£o do fluxo de pagamento. Cada passo ir√° atualizar esta √°rea com uma explica√ß√£o detalhada e c√≥digo de exemplo.</p>
                        </div>
                    </div>
                </section>

                <section id="details" class="content-section hidden">
                    <h2 class="text-3xl font-bold text-gray-900 mb-2">Detalhes T√©cnicos</h2>
                    <p class="text-lg text-gray-600 mb-8">As opera√ß√µes de WebAuthn e SPC dependem de estruturas de dados espec√≠ficas. As tabelas abaixo detalham os par√¢metros-chave. Passe o mouse sobre uma linha para uma breve descri√ß√£o.</p>
                    <h3 class="text-2xl font-semibold text-gray-800 mt-8 mb-4">Par√¢metros Chave do WebAuthn</h3>
                    <div class="overflow-x-auto bg-white rounded-xl border border-gray-200">
                        <table class="w-full text-left">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="p-4 font-semibold">Par√¢metro</th>
                                    <th class="p-4 font-semibold">Aplicabilidade</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                <tr class="hover:bg-gray-50" title="Identificador da Parte Confi√°vel (geralmente o dom√≠nio do seu site).">
                                    <td class="p-4 font-mono">rp.id</td>
                                    <td class="p-4">Cria√ß√£o, Autentica√ß√£o</td>
                                </tr>
                                <tr class="hover:bg-gray-50" title="Identificador √∫nico do usu√°rio no seu sistema, fornecido como um ArrayBuffer.">
                                    <td class="p-4 font-mono">user.id</td>
                                    <td class="p-4">Cria√ß√£o</td>
                                </tr>
                                <tr class="hover:bg-gray-50" title="Valor aleat√≥rio e √∫nico gerado pelo servidor para prevenir ataques de repeti√ß√£o.">
                                    <td class="p-4 font-mono">challenge</td>
                                    <td class="p-4">Cria√ß√£o, Autentica√ß√£o</td>
                                </tr>
                                <tr class="hover:bg-gray-50" title="Especifica os algoritmos de chave p√∫blica aceitos (ex: ES256).">
                                    <td class="p-4 font-mono">pubKeyCredParams</td>
                                    <td class="p-4">Cria√ß√£o</td>
                                </tr>
                                <tr class="hover:bg-gray-50" title="Exige que o usu√°rio se verifique (biometria/PIN), n√£o apenas que esteja presente.">
                                    <td class="p-4 font-mono">userVerification</td>
                                    <td class="p-4">Cria√ß√£o, Autentica√ß√£o</td>
                                </tr>
                                <tr class="hover:bg-gray-50" title="Controla a UI do navegador, 'conditional' permite o preenchimento autom√°tico.">
                                    <td class="p-4 font-mono">mediation</td>
                                    <td class="p-4">Autentica√ß√£o</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <h3 class="text-2xl font-semibold text-gray-800 mt-8 mb-4">Campos de Dados da Solicita√ß√£o SPC</h3>
                    <div class="overflow-x-auto bg-white rounded-xl border border-gray-200">
                        <table class="w-full text-left">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="p-4 font-semibold">Campo</th>
                                    <th class="p-4 font-semibold">Obrigat√≥rio</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                <tr class="hover:bg-gray-50" title="Valor aleat√≥rio criptogr√°fico fornecido pelo servidor.">
                                    <td class="p-4 font-mono">challenge</td>
                                    <td class="p-4">Obrigat√≥rio</td>
                                </tr>
                                <tr class="hover:bg-gray-50" title="Lista de IDs de credenciais WebAuthn registradas para o pagamento.">
                                    <td class="p-4 font-mono">credentialIds</td>
                                    <td class="p-4">Obrigat√≥rio</td>
                                </tr>
                                <tr class="hover:bg-gray-50" title="Nome do instrumento de pagamento (ex: 'Visa **** 1234').">
                                    <td class="p-4 font-mono">instrument.displayName</td>
                                    <td class="p-4">Obrigat√≥rio</td>
                                </tr>
                                <tr class="hover:bg-gray-50" title="URL do √≠cone do instrumento de pagamento (ex: logo da bandeira).">
                                    <td class="p-4 font-mono">instrument.icon</td>
                                    <td class="p-4">Obrigat√≥rio</td>
                                </tr>
                                <tr class="hover:bg-gray-50" title="Nome de exibi√ß√£o do benefici√°rio (o comerciante).">
                                    <td class="p-4 font-mono">payeeName</td>
                                    <td class="p-4">Opcional</td>
                                </tr>
                                 <tr class="hover:bg-gray-50" title="Origem (dom√≠nio) do benefici√°rio.">
                                    <td class="p-4 font-mono">payeeOrigin</td>
                                    <td class="p-4">Opcional</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <section id="security" class="content-section hidden">
                    <h2 class="text-3xl font-bold text-gray-900 mb-2">Considera√ß√µes de Seguran√ßa</h2>
                    <p class="text-lg text-gray-600 mb-8">A implementa√ß√£o de passkeys e SPC requer aten√ß√£o a detalhes de seguran√ßa cr√≠ticos para proteger os usu√°rios e as transa√ß√µes. O princ√≠pio mais importante √© a mitiga√ß√£o de ataques de repeti√ß√£o.</p>
                    <div class="bg-white p-6 rounded-xl border border-gray-200">
                        <div class="flex items-start">
                            <div class="flex-shrink-0 h-12 w-12 rounded-full bg-red-100 flex items-center justify-center">
                                <span class="text-2xl">üõ°Ô∏è</span>
                            </div>
                            <div class="ml-4">
                                <h3 class="font-semibold text-lg text-gray-800">Mitigando Ataques de Repeti√ß√£o com `challenge`</h3>
                                <p class="text-gray-600 mt-1">O `challenge` √© a principal defesa contra ataques de repeti√ß√£o, onde um invasor intercepta uma resposta de autentica√ß√£o e a reutiliza.</p>
                                <ul class="list-disc list-inside mt-4 space-y-2 text-gray-600">
                                    <li><strong>√önico por Solicita√ß√£o:</strong> O backend DEVE gerar um novo `challenge` criptograficamente seguro para cada tentativa de registro ou autentica√ß√£o.</li>
                                    <li><strong>Validade Curta:</strong> O `challenge` deve ser armazenado na sess√£o do usu√°rio e ter uma vida √∫til curta (alguns minutos).</li>
                                    <li><strong>Uso √önico:</strong> Uma vez que um `challenge` √© usado (seja em uma tentativa bem-sucedida ou falha), ele DEVE ser invalidado imediatamente no backend para que n√£o possa ser usado novamente.</li>
                                </ul>
                                <p class="text-sm text-gray-500 mt-4">Usar uma biblioteca FIDO no lado do servidor (como SimpleWebAuthn) ajuda a gerenciar esses requisitos de seguran√ßa de forma robusta e confi√°vel.</p>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <script>
        const sections = document.querySelectorAll('.content-section');
        const navLinks = document.querySelectorAll('.nav-link');
        const mobileNav = document.getElementById('mobile-nav');

        function setActiveSection(hash) {
            const targetHash = hash.startsWith('#') ? hash : `#${hash}`;
            
            sections.forEach(section => {
                if (`#${section.id}` === targetHash) {
                    section.classList.remove('hidden');
                } else {
                    section.classList.add('hidden');
                }
            });

            navLinks.forEach(link => {
                if (link.getAttribute('href') === targetHash) {
                    link.classList.add('sidebar-active');
                } else {
                    link.classList.remove('sidebar-active');
                }
            });
            
            if (mobileNav.value !== hash.substring(1)) {
                mobileNav.value = hash.substring(1);
            }
            
            window.scrollTo(0, 0);
        }

        function handleNavigation(event) {
            event.preventDefault();
            const targetHash = event.currentTarget.getAttribute('href');
            setActiveSection(targetHash);
            history.pushState(null, null, targetHash);
        }

        navLinks.forEach(link => {
            link.addEventListener('click', handleNavigation);
        });

        mobileNav.addEventListener('change', (event) => {
            const targetHash = `#${event.target.value}`;
            setActiveSection(targetHash);
            history.pushState(null, null, targetHash);
        });

        window.addEventListener('popstate', () => {
            const hash = window.location.hash || '#intro';
            setActiveSection(hash);
        });
        
        document.addEventListener('DOMContentLoaded', () => {
            const hash = window.location.hash || '#intro';
            setActiveSection(hash);
        });
        
        const creationScreenContent = document.getElementById('creation-screen-content');
        const creationScreenActions = document.getElementById('creation-screen-actions');
        const creationExplanation = document.getElementById('creation-explanation');
        const creationProgressBar = document.getElementById('creation-progress-bar');
        let creationStep = 0;

        function updateCreationProgressBar(currentStep, totalSteps) {
            const percentage = ((currentStep + 1) / totalSteps) * 100;
            creationProgressBar.style.width = `${percentage}%`;
        }

        const creationSteps = [
            {
                title: 'In√≠cio do Processo',
                screen: `
                    <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#A78BFA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-key-round mb-4"><path d="M2 18v2a2 2 0 0 0 2 2h4"/><path d="M15 22h2a2 2 0 0 0 2-2v-2"/><path d="M2 13v-2a2 2 0 0 1 2-2h10l3-3 3 3v2l-3 3h-2"/><path d="M7 11h2"/></svg>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">Cria√ß√£o de Passkey</h3>
                    <p class="text-gray-600">Bem-vindo! Clique no bot√£o abaixo para iniciar o processo de cria√ß√£o da sua passkey.</p>
                `,
                actions: `
                    <button class="bg-[#A78BFA] text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-[#8B5CF6] transition-colors" onclick="nextCreationStep()">Criar Passkey</button>
                `,
                explanation: `
                    <h3 class="font-semibold text-lg text-gray-800">Passo 1: Frontend Inicia o Registro</h3>
                    <p class="text-gray-600 mt-2">A jornada come√ßa com o usu√°rio interagindo com a interface. O frontend, em resposta a essa a√ß√£o, faz uma chamada de rede para o backend para obter os par√¢metros necess√°rios para a cria√ß√£o da passkey. Esta √© a primeira etapa para garantir a seguran√ßa da transa√ß√£o.</p>
                    <pre><code class="language-js"><span class="code-comment">// Exemplo de chamada do frontend para o backend</span>
<span class="code-keyword">const</span> <span class="code-variable">response</span> = <span class="code-keyword">await</span> <span class="code-function">fetch</span>(<span class="code-string">'/generate-registration-options'</span>);
<span class="code-keyword">const</span> <span class="code-variable">options</span> = <span class="code-keyword">await</span> <span class="code-variable">response</span>.<span class="code-function">json</span>();
<span class="code-comment">// 'options' agora cont√©m o challenge e outros par√¢metros do backend</span>
                    </code></pre>
                `
            },
            {
                title: 'Backend Gera Op√ß√µes',
                screen: `
                    <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#A78BFA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-server mb-4"><rect width="20" height="8" x="2" y="2" rx="2" ry="2"/><rect width="20" height="8" x="2" y="14" rx="2" ry="2"/><line x1="6" x2="6.01" y1="6" y2="6"/><line x1="6" x2="6.01" y1="18" y2="18"/></svg>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">Conectando ao Servidor...</h3>
                    <p class="text-gray-600">O servidor est√° gerando um token de seguran√ßa √∫nico (challenge) e outras op√ß√µes para a sua passkey.</p>
                `,
                actions: `
                    <button class="bg-[#A78BFA] text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-[#8B5CF6] transition-colors" onclick="nextCreationStep()">Simular ` + `<span class="code-function">navigator.credentials.create()</span></button>
                `,
                explanation: `
                    <h3 class="font-semibold text-lg text-gray-800">Passo 2: Backend Gera Op√ß√µes</h3>
                    <p class="text-gray-600 mt-2">O backend tem a responsabilidade cr√≠tica de gerar as op√ß√µes para a cria√ß√£o da credencial. A pe√ßa mais importante √© o <code>challenge</code>, um buffer de bytes aleat√≥rios e criptograficamente seguro que previne ataques de repeti√ß√£o.</p>
                    <pre><code class="language-js"><span class="code-comment">// Exemplo de l√≥gica de backend (usando uma biblioteca FIDO)</span>
<span class="code-keyword">import</span> { <span class="code-variable">generateRegistrationOptions</span> } <span class="code-keyword">from</span> <span class="code-string">'@simplewebauthn/server'</span>;
<span class="code-keyword">const</span> <span class="code-variable">options</span> = <span class="code-keyword">await</span> <span class="code-function">generateRegistrationOptions</span>({
  <span class="code-variable">rpID</span>: <span class="code-string">'example.com'</span>,
  <span class="code-variable">rpName</span>: <span class="code-string">'My Awesome App'</span>,
  <span class="code-variable">userID</span>: <span class="code-string">'user-unique-id'</span>,
  <span class="code-variable">userName</span>: <span class="code-string">'user@example.com'</span>,
});
<span class="code-comment">// O backend deve salvar 'options.challenge' na sess√£o do usu√°rio</span>
                    </code></pre>
                `
            },
            {
                title: 'Confirma√ß√£o do Usu√°rio',
                screen: `
                    <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#A78BFA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-fingerprint mb-4"><path d="M2 12C2 6.5 6.5 2 12 2a10 10 0 0 1 8 4"/><path d="M5 12C5 8.1 8.1 5 12 5c2.6 0 4.8.8 6.7 2.2"/><path d="M12 12v10"/><path d="M12 12c-1.4 0-2.7.4-4.4 1.3"/><path d="M14 10a2 2 0 0 1 2 2c0 2-1 3-1 3"/><path d="M16 12h2"/><path d="M22 12a10 10 0 0 1-2 6"/><path d="M15 22v-4a2 2 0 0 0-2-2"/><path d="M12 17c-1 0-2.4-.6-4-1.3"/><path d="M20 15v-3"/></svg>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">Confirme sua Passkey</h3>
                    <p class="text-gray-600">O navegador est√° solicitando sua confirma√ß√£o. Use sua biometria, PIN ou senha para autorizar.</p>
                `,
                actions: `
                    <button class="bg-[#34D399] text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-[#10B981] transition-colors" onclick="nextCreationStep()">Autenticado</button>
                `,
                explanation: `
                    <h3 class="font-semibold text-lg text-gray-800">Passo 3: Chamada ` + `<span class="code-function">navigator.credentials.create()</span>` + `</h3>
                    <p class="text-gray-600 mt-2">Com as op√ß√µes do backend, o frontend invoca a API do navegador <code>navigator.credentials.create()</code>. O navegador ent√£o exibe uma interface nativa que pede a confirma√ß√£o do usu√°rio (biometria, PIN ou senha), garantindo uma experi√™ncia segura e consistente.</p>
                    <pre><code class="language-js"><span class="code-comment">// Frontend recebe 'options' do backend e chama a API</span>
<span class="code-keyword">let</span> <span class="code-variable">newCredential</span>;
<span class="code-keyword">try</span> {
  <span class="code-variable">newCredential</span> = <span class="code-keyword">await</span> <span class="code-variable">navigator</span>.<span class="code-variable">credentials</span>.<span class="code-function">create</span>({
    <span class="code-variable">publicKey</span>: <span class="code-variable">options</span>
  });
} <span class="code-keyword">catch</span> (e) {
  <span class="code-comment">// Lidar com erros, como o usu√°rio cancelar a opera√ß√£o</span>
}
                    </code></pre>
                `
            },
            {
                title: 'Sucesso',
                screen: `
                    <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#34D399" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check-circle mb-4"><path d="M22 11.08V12a10 10 0 1 1-5.93-8.62"/><path d="m9 11 3 3L22 4"/></svg>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">Passkey Criada!</h3>
                    <p class="text-gray-600">Sua nova passkey foi criada e est√° pronta para ser usada de forma segura.</p>
                `,
                actions: `
                    <button class="bg-gray-300 text-gray-800 font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-gray-400 transition-colors" onclick="resetCreationSimulation()">Reiniciar Simula√ß√£o</button>
                `,
                explanation: `
                    <h3 class="font-semibold text-lg text-gray-800">Passo 4: Backend Verifica e Armazena</h3>
                    <p class="text-gray-600 mt-2">A credencial √© enviada de volta ao servidor, que a valida criptograficamente, verifica o <code>challenge</code> e armazena a chave p√∫blica no banco de dados. Este √© o passo final que garante a seguran√ßa e integridade do processo de registro.</p>
                    <pre><code class="language-js"><span class="code-comment">// Exemplo de verifica√ß√£o no backend</span>
<span class="code-keyword">import</span> { <span class="code-variable">verifyRegistrationResponse</span> } <span class="code-keyword">from</span> <span class="code-string">'@simplewebauthn/server'</span>;
<span class="code-keyword">const</span> <span class="code-variable">verification</span> = <span class="code-keyword">await</span> <span class="code-function">verifyRegistrationResponse</span>({
  <span class="code-variable">response</span>: <span class="code-variable">newCredential</span>,
  <span class="code-variable">expectedChallenge</span>: <span class="code-variable">userSession</span>.<span class="code-variable">currentChallenge</span>,
  <span class="code-variable">expectedOrigin</span>: <span class="code-string">'https://example.com'</span>,
});
                    </code></pre>
                `
            }
        ];

        function nextCreationStep() {
            creationStep = (creationStep + 1) % creationSteps.length;
            const step = creationSteps[creationStep];
            creationScreenContent.classList.remove('animate-fade-in');
            void creationScreenContent.offsetWidth; // Trigger reflow
            creationScreenContent.innerHTML = step.screen;
            creationScreenActions.innerHTML = step.actions;
            creationExplanation.innerHTML = step.explanation;
            creationScreenContent.classList.add('animate-fade-in');
            updateCreationProgressBar(creationStep, creationSteps.length);
        }

        function resetCreationSimulation() {
            creationStep = -1;
            nextCreationStep();
        }
        
        const paymentScreenContent = document.getElementById('payment-screen-content');
        const paymentScreenActions = document.getElementById('payment-screen-actions');
        const paymentExplanation = document.getElementById('payment-explanation');
        const paymentProgressBar = document.getElementById('payment-progress-bar');
        let paymentStep = 0;

        function updatePaymentProgressBar(currentStep, totalSteps) {
            const bar = document.getElementById('payment-progress-bar');
            const percentage = ((currentStep + 1) / totalSteps) * 100;
            bar.style.width = `${percentage}%`;
        }

        const paymentSteps = [
            {
                title: 'In√≠cio do Pagamento',
                screen: `
                    <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#34D399" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-credit-card mb-4"><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></svg>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">Pagar com Passkey</h3>
                    <p class="text-gray-600">Clique em "Pagar com Passkey" para iniciar a simula√ß√£o de uma transa√ß√£o com SPC.</p>
                `,
                actions: `
                    <button class="bg-[#34D399] text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-[#10B981] transition-colors" onclick="nextPaymentStep()">Pagar com Passkey</button>
                `,
                explanation: `
                    <h3 class="font-semibold text-lg text-gray-800">Passo 1: A√ß√£o do Usu√°rio</h3>
                    <p class="text-gray-600 mt-2">O fluxo de pagamento come√ßa com o usu√°rio iniciando a transa√ß√£o. O frontend prepara a requisi√ß√£o de pagamento e solicita ao backend as op√ß√µes para o SPC, incluindo o token de seguran√ßa (challenge) e os detalhes da transa√ß√£o.</p>
                    <pre><code class="language-js"><span class="code-comment">// Exemplo de chamada do frontend para o backend</span>
<span class="code-keyword">const</span> <span class="code-variable">response</span> = <span class="code-keyword">await</span> <span class="code-function">fetch</span>(<span class="code-string">'/initiate-spc-payment'</span>);
<span class="code-keyword">const</span> <span class="code-variable">options</span> = <span class="code-keyword">await</span> <span class="code-variable">response</span>.<span class="code-function">json</span>();
<span class="code-comment">// 'options' cont√©m os detalhes do pagamento e o challenge</span>
                    </code></pre>
                `
            },
            {
                title: 'Carrinho de Compras',
                screen: `
                    <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#34D399" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shopping-cart mb-4"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.5 2h1.5l4.5 12.5c.3.8.9 1.5 1.7 1.7L19 19H8"/></svg>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">Carrinho de Compras</h3>
                    <div class="grid grid-cols-2 gap-4 mt-4 w-full text-left">
                        <img src="https://placehold.co/100x100/A78BFA/ffffff?text=Produto" alt="Produto" class="rounded-lg">
                        <div>
                            <h4 class="font-semibold">Decov Shop</h4>
                            <p class="text-sm text-gray-600">Tapete decorativo premium</p>
                            <p class="font-bold text-lg mt-1">R$ 59,99</p>
                        </div>
                    </div>
                `,
                actions: `
                    <button class="bg-[#34D399] text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-[#10B981] transition-colors" onclick="nextPaymentStep()">Finalizar Compra</button>
                `,
                explanation: `
                    <h3 class="font-semibold text-lg text-gray-800">Passo 2: Exibi√ß√£o do Carrinho</h3>
                    <p class="text-gray-600 mt-2">O usu√°rio revisa o carrinho de compras. Esta tela simula a interface do seu site. Ao clicar em "Finalizar Compra", o navegador iniciar√° o processo de Secure Payment Confirmation (SPC) para autenticar o pagamento de forma segura.</p>
                `
            },
            {
                title: 'Detalhes do Pedido',
                screen: `
                    <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#34D399" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-server mb-4"><rect width="20" height="8" x="2" y="2" rx="2" ry="2"/><rect width="20" height="8" x="2" y="14" rx="2" ry="2"/><line x1="6" x2="6.01" y1="6" y2="6"/><line x1="6" x2="6.01" y1="18" y2="18"/></svg>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">Conectando ao Servidor...</h3>
                    <p class="text-gray-600">O servidor est√° preparando os detalhes da transa√ß√£o para o SPC.</p>
                `,
                actions: `
                    <button class="bg-[#34D399] text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-[#10B981] transition-colors" onclick="nextPaymentStep()">Simular ` + `<span class="code-function">PaymentRequest.show()</span>` + `</button>
                `,
                explanation: `
                    <h3 class="font-semibold text-lg text-gray-800">Passo 3: Backend Prepara Dados SPC</h3>
                    <p class="text-gray-600 mt-2">O backend constr√≥i o objeto <code>SecurePaymentConfirmationRequest</code>, que cont√©m os detalhes da transa√ß√£o (como valor e benefici√°rio) e o <code>challenge</code>. Estes dados s√£o enviados para o frontend. A imagem acima √© apenas um mock visual.</p>
                    <pre><code class="language-js"><span class="code-comment">// Exemplo de l√≥gica de backend para gerar as op√ß√µes de pagamento</span>
<span class="code-keyword">const</span> <span class="code-variable">paymentOptions</span> = {
  <span class="code-variable">rp</span>: { <span class="code-variable">id</span>: <span class="code-string">'lojaonline.com'</span>, <span class="code-variable">name</span>: <span class="code-string">'Minha Loja Online'</span> },
  <span class="code-variable">challenge</span>: <span class="code-variable">crypto</span>.<span class="code-function">randomUUID</span>(),
  <span class="code-variable">instrument</span>: {
    <span class="code-variable">displayName</span>: <span class="code-string">'Visa **** 1234'</span>,
    <span class="code-variable">icon</span>: <span class="code-string">'https://lojaonline.com/visa.svg'</span>
  },
  <span class="code-variable">payeeName</span>: <span class="code-string">'Minha Loja Online'</span>
};
<span class="code-comment">// O backend deve salvar paymentOptions.challenge na sess√£o</span>
                    </code></pre>
                `
            },
            {
                title: 'Confirma√ß√£o de Pagamento',
                screen: `
                    <div class="flex-1 flex flex-col justify-center items-center text-center p-4">
                        <div class="p-6 bg-white rounded-2xl shadow-xl w-64 text-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#A78BFA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-wallet mb-4"><path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1h-3m-6 0v4a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-2"/><path d="M22 7V4a1 1 0 0 0-1-1H3a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h18a1 1 0 0 0 1-1z"/><path d="M3 11v-1a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v1"/><line x1="12" x2="12" y1="12" y2="12"/></svg>
                            <p class="mt-4 font-semibold text-lg text-gray-800">Pagar R$ 59,99 para a Loja Online?</p>
                            <div class="mt-4 flex flex-col space-y-2 text-sm text-gray-600">
                                <p>Use sua passkey para confirmar a compra de forma segura.</p>
                            </div>
                        </div>
                    </div>
                `,
                actions: `
                    <button class="bg-[#A78BFA] text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-[#8B5CF6] transition-colors" onclick="nextPaymentStep()">Confirmar</button>
                `,
                explanation: `
                    <h3 class="font-semibold text-lg text-gray-800">Passo 4: Chamada ` + `<span class="code-function">PaymentRequest.show()</span>` + ` com SPC</h3>
                    <p class="text-gray-600 mt-2">O frontend usa a <code>PaymentRequest API</code> com o m√©todo <code>"secure-payment-confirmation"</code>. A API exibe a interface nativa do navegador para o usu√°rio, que assina a transa√ß√£o com sua passkey. Isso cria um v√≠nculo din√¢mico, provando que o usu√°rio consentiu com a transa√ß√£o e n√£o apenas fez login.</p>
                    <pre><code class="language-js"><span class="code-comment">// Frontend recebe 'paymentOptions' do backend e chama a API</span>
<span class="code-keyword">const</span> <span class="code-variable">paymentMethods</span> = [{
  <span class="code-variable">supportedMethods</span>: <span class="code-string">'secure-payment-confirmation'</span>,
  <span class="code-variable">data</span>: <span class="code-variable">paymentOptions</span>
}];
<span class="code-keyword">const</span> <span class="code-variable">request</span> = <span class="code-keyword">new</span> <span class="code-function">PaymentRequest</span>(<span class="code-variable">paymentMethods</span>, <span class="code-variable">details</span>);
<span class="code-keyword">const</span> <span class="code-variable">response</span> = <span class="code-keyword">await</span> <span class="code-variable">request</span>.<span class="code-function">show</span>();
                    </code></pre>
                `
            },
            {
                title: 'Autentica√ß√£o Biom√©trica',
                screen: `
                    <div class="flex flex-col items-center justify-center flex-1">
                        <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#A78BFA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-fingerprint mb-6"><path d="M2 12C2 6.5 6.5 2 12 2a10 10 0 0 1 8 4"/><path d="M5 12C5 8.1 8.1 5 12 5c2.6 0 4.8.8 6.7 2.2"/><path d="M12 12v10"/><path d="M12 12c-1.4 0-2.7.4-4.4 1.3"/><path d="M14 10a2 2 0 0 1 2 2c0 2-1 3-1 3"/><path d="M16 12h2"/><path d="M22 12a10 10 0 0 1-2 6"/><path d="M15 22v-4a2 2 0 0 0-2-2"/><path d="M12 17c-1 0-2.4-.6-4-1.3"/><path d="M20 15v-3"/></svg>
                        <h3 class="text-xl font-semibold text-gray-800">Confirme com biometria</h3>
                        <p class="text-gray-600 mt-2">Use sua digital ou Face ID para autorizar.</p>
                    </div>
                `,
                actions: `
                    <button class="bg-[#34D399] text-white py-3 px-6 rounded-lg shadow-md hover:bg-[#10B981] transition-colors" onclick="nextPaymentStep()">Usar Biometria</button>
                `,
                explanation: `
                    <h3 class="font-semibold text-lg text-gray-800">Passo 5: Autentica√ß√£o Biom√©trica do Usu√°rio</h3>
                    <p class="text-gray-600 mt-2">Nesta etapa, o navegador exibe a interface de autentica√ß√£o nativa, como Face ID, Touch ID ou a digital do Android. A passkey √© usada para criar uma assinatura digital da transa√ß√£o, que ser√° enviada de volta ao servidor.</p>
                `
            },
            {
                title: 'Pagamento Conclu√≠do',
                screen: `
                    <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#34D399" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check-circle mb-4"><path d="M22 11.08V12a10 10 0 1 1-5.93-8.62"/><path d="m9 11 3 3L22 4"/></svg>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">Pagamento Autorizado!</h3>
                    <p class="text-gray-600">Sua transa√ß√£o foi confirmada com sucesso de forma segura usando passkey.</p>
                `,
                actions: `
                    <button class="bg-gray-300 text-gray-800 font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-gray-400 transition-colors" onclick="resetPaymentSimulation()">Reiniciar Simula√ß√£o</button>
                `,
                explanation: `
                    <h3 class="font-semibold text-lg text-gray-800">Passo 6: Backend Verifica a Assinatura</h3>
                    <p class="text-gray-600 mt-2">O backend recebe a resposta do pagamento, que cont√©m uma asser√ß√£o WebAuthn. A verifica√ß√£o √© similar a um login, mas o backend tamb√©m verifica se os dados da transa√ß√£o no <code>clientDataJSON</code> correspondem aos dados que ele mesmo gerou. Se tudo estiver correto, o pagamento √© processado e o fluxo √© conclu√≠do.</p>
                    <pre><code class="language-js"><span class="code-comment">// Exemplo de verifica√ß√£o no backend</span>
<span class="code-keyword">const</span> <span class="code-variable">verification</span> = <span class="code-keyword">await</span> <span class="code-function">verifyPaymentResponse</span>({
  <span class="code-variable">response</span>: <span class="code-variable">paymentResponse</span>,
  <span class="code-variable">expectedChallenge</span>: <span class="code-variable">userSession</span>.<span class="code-variable">currentChallenge</span>,
  <span class="code-variable">expectedOrigin</span>: <span class="code-string">'https://lojaonline.com'</span>,
  <span class="code-variable">paymentData</span>: <span class="code-variable">expectedPaymentData</span>
});
                    </code></pre>
                `
            }
        ];

        function nextPaymentStep() {
            paymentStep = (paymentStep + 1) % paymentSteps.length;
            const step = paymentSteps[paymentStep];
            
            // Apply fade transition
            paymentScreenContent.classList.remove('animate-fade-in');
            void paymentScreenContent.offsetWidth; // Trigger reflow
            paymentScreenContent.innerHTML = step.screen;
            paymentScreenActions.innerHTML = step.actions;
            paymentExplanation.innerHTML = step.explanation;
            paymentScreenContent.classList.add('animate-fade-in');
            
            updatePaymentProgressBar(paymentStep, paymentSteps.length);
        }
        
        function resetPaymentSimulation() {
            paymentStep = -1;
            nextPaymentStep();
        }
    </script>
</body>
</html>
